\documentclass[fleqn, final]{../styles/unmphythesis}
\usepackage{../styles/qxd}
\renewcommand{\thechapter}{3}
%\newcommand{\thechapter}{1}

\makeindex
\begin{document}

%<*quantumdynamics>

\chapter[QND measurement and spin squeezing with photonic waveguides]{Quantum non-demolition measurement and spin squeezing with nanophotonic waveguides}\label{chap:quantumdynamicsrepresentation}
\section{Introduction}
In the last chapter, we have treated the light as a classical field. 
In this chapter, we will fully quantize the optical field and study the quantum noise origin of the light by redefining the Stokes operators using the bosonic operators, and introduce the Hamiltonian of the atom-light interaction for the quantum non-demolition (QND) measurement. We will also link the collective spin operators to the traditional squeezing operators and finally introduce the QND-measurement--induced spin squeezing. 

\section[Atom-light coupling with waveguide modes]{Atom-light coupling with waveguide modes}
We consider atoms are trapped on a one-side or two-side chain of optical lattice near a nanophotonic waveguide and a probe is launched to perform the quantum measurement using the polarization spectroscopy technique introduced in the last chapter. We assume all atoms are trapped at the same distance to the waveguide surface and have the same local intensity of the probe. Defects of occupations on the optical lattices are allowed in our theory, and the minimum distance between atoms is large enough that we can ignore the photon scattering effect among atoms in the dispersive regime. Experiments on implementing such an atom-waveguide quantum interface have been done with optical nanofibers~\cite{Goban2012,Lacroute2012,Vetsch2010Optical,Lee2015,Beguin2014,Bajcsy2011Laser}, integrated optical waveguide couplers~\cite{Lee2013} and photonic crystal waveguides~\cite{Yu2014,Goban2014}. The designs of general nanophotonic waveguides for feasible atomic traps and atom-light interaction experiments have also been proposed for a broader range of atom-waveguide interfaces~\cite{Muniz2015Designing,Hung2013,Lee2017Characterizations}. We focus on the waveguides that allows two orthogonally polarized forward-propagating guided modes with degenerate group index of refraction, $ n_g $. 

Given an input light that adiabatically connects to the forward-propagating quasi-monochromatic $ p $-mode at frequency $ \omega_0 $, we define the field operators $ \hat{a}^\dagger_p(z,t) $ by~\cite{Gardiner1985Input,Blow1990Continuum,LeKien2008}
	\begin{align}
		\hat{a}_{p}(z,t) =\frac{1}{\sqrt{2 \pi}}  \int_0^{\infty}\!\!\!\!\! d \omega \, \hat{a}_{p}(\omega) e^{i[\beta_0 z- (\omega-\omega_0) t ]}, 
	\end{align}
that satisfy the free-field commutation relations,
	\begin{equation} \label{Eq::InputOutputCommutation}
		\big[\hat{a}_{p}(z,t),\hat{a}^\dag_{p'}(z',t')\big]=\delta_{p,p'}  \delta(t-t'-(z-z')/v_g).
	\end{equation}
The corresponding positive-frequency electric field operators in the orthogonal mode basis can be defined as
	\begin{equation} \label{Eq::PropagatingElectricField_forward}
		\hat{\mathbf{E}}^{(+)}(r\!_\perp,\phi,z;t) = \sum_{p} \sqrt{ \frac{2 \pi \hbar \omega_0}{ v_g} } \mathbf{u}_{p}(r\!_\perp,\phi) \hat{a}_{p}(z,t)  e^{i \beta_0 z},
	\end{equation}	
where the sum over $ p $ includes all components of a complete mode basis. Below, we only consider the $ \{H,V \} $ mode basis. The transformation of operators to another arbitrary mode bases is derived in Appendix~\ref{chap:basistransfHS}. 
With $ N_A $ atoms interacting with the propagating electric field of the local guided modes, the dispersive light-shift Hamiltonian can be defined as~\cite{Deutsch2010a,LeKien2013,Baragiola2014Open},
	\begin{equation} \label{Eq::LightShiftHam_forward}
		\hat{H}_{LS} = \sum_{n=1}^{N_A} \hat{h}_{\rm eff},
	\end{equation}
with the light-atom interaction Hamiltonian with one atom given by
\begin{align}
\hat{h}_\eff &= -\hat{\mathbf{E}}^{(-)}(\br')\cdot\hat{\tensor{\mathbf{\alpha}}}\cdot\hat{\mathbf{E}}^{(+)}(\br')\nn\\
&= -\frac{2\pi\hbar\omega}{v_g}\left[\mathbf{u}_H^*\cdot\hat{\tensor{\mathbf{\alpha}}}\cdot \mathbf{u}_H\hat{a}_H^\dagger\hat{a}_H\right.
+ \mathbf{u}_H^*\cdot\hat{\tensor{\mathbf{\alpha}}}\cdot \mathbf{u}_V\hat{a}_H^\dagger\hat{a}_V\nn\\
&\quad\quad + \mathbf{u}_V^*\cdot\hat{\tensor{\mathbf{\alpha}}}\cdot \mathbf{u}_H\hat{a}_V^\dagger\hat{a}_H 
\left. + \mathbf{u}_V^*\cdot\hat{\tensor{\mathbf{\alpha}}}\cdot \mathbf{u}_V\hat{a}_V^\dagger\hat{a}_V\right]\\
&= \hbar\left[(\hat{\chi}_{HH}+\hat{\chi}_{VV})\hat{S}_0 + (\hat{\chi}_{HH}-\hat{\chi}_{VV})\hat{S}_1 \right.\nn\\
&\quad \quad\left. + (\hat{\chi}_{HV}+\hat{\chi}_{VH})\hat{S}_2 + i(\hat{\chi}_{HV}-\hat{\chi}_{VH})\hat{S}_3 \right]\\
%\hbar \left[\left(\chi_{RR\uparrow} + \chi_{RR\downarrow} +\chi_{LL\uparrow}+\chi_{LL\downarrow} \right)\hat{F}_0\hat{S}_0 \right.\nonumber\\
%&\quad+\left(\chi_{RR\uparrow} + \chi_{RR\downarrow} -\chi_{LL\uparrow}-\chi_{LL\downarrow} \right)\hat{F}_0\hat{S}_3\nonumber\\
%&\quad+\left(\chi_{RR\uparrow} + \chi_{LL\uparrow} -\chi_{RR\downarrow}-\chi_{LL\downarrow} \right)\hat{F}_3\hat{S}_0\nonumber\\
%&\quad+\left(\chi_{RR\uparrow} - \chi_{RR\downarrow} +\chi_{LL\downarrow}-\chi_{LL\uparrow} \right)\hat{F}_3\hat{S}_3\nonumber\\
%&\quad+i\left(\chi_{LR\uparrow} - \chi_{RL\uparrow} +\chi_{RL\downarrow}-\chi_{RL\downarrow} \right)\hat{F}_0\hat{S}_1\nonumber\\
%&\quad+\left(\chi_{RL\uparrow} + \chi_{LR\uparrow} +\chi_{RL\downarrow}+\chi_{LR\downarrow} \right)\hat{F}_0\hat{S}_2\nonumber\\
%&\quad+i\left(\chi_{LR\uparrow} - \chi_{RL\uparrow} +\chi_{RL\downarrow}-\chi_{LR\downarrow} \right)\hat{F}_3\hat{S}_1\nonumber\\
%&\quad+\left.\left(\chi_{LR\uparrow} + \chi_{RL\uparrow} -\chi_{LR\downarrow}-\chi_{RL\downarrow} \right)\hat{F}_3\hat{S}_2 \right]\\
&=\hbar\sum_{i=0}^3 \hat{\chi}_{i}\hat{S}_i\\
&=\hbar\sum_{i,j=0} \chi_{ij}\hat{f}_i\hat{S}_j,
\end{align}
where $\poltens$ is the atomic tensor polarizability operator, given in \erf{Eq::AtomicPolarizabilityF}, for each atom trapped near the waveguide surface at position $\mathbf{r}'_\perp$ in the transverse plane. We ignore here any effects of atomic motion and treat the atoms as localized at fixed positions in space. We have also defined $ \hat{S}_i $ as the Stokes vector operators of the light indicating its polarization. The vector Stokes operators that describe the polarization of the propagating fields in the quasilinear $HV$-basis are given as below:
\begin{subequations}\label{Eq::StokesComponents}
	\begin{align} 
		\hat{S}_1(t) & = \smallfrac{1}{2}\big[ \hat{a}^\dag_H(t) \hat{a}_H(t)-\hat{a}^\dag_V(t) \hat{a}_V(t) \big], \\
	 	\hat{S}_2(t) & = \smallfrac{1}{2}\big[ \hat{a}^\dag_H(t) \hat{a}_V(t)+\hat{a}^\dag_V(t) \hat{a}_H(t) \big], \\ 
		\hat{S}_3(t) & = \smallfrac{1}{2i}\big[ \hat{a}^\dag_H(t) \hat{a}_V(t) -\hat{a}^\dag_V(t) \hat{a}_H(t) \big],
	\end{align}
\end{subequations}
that satisfy equal-$z$ commutation relations following from \erf{Eq::InputOutputCommutation},
	\begin{equation} \label{Eq::StokesCommutation}
		\big[\hat{S}_i(t), \hat{S}_j(t')\big] =i \epsilon_{ijk} \delta(t-t')  \hat{S}_k(t).
	\end{equation}
These, along with the total photon flux operator,
	\begin{equation}
		\hat{S}_0(t) = \smallfrac{1}{2}\big[ \hat{a}^\dag_H(t) \hat{a}_H(t)+\hat{a}^\dag_V(t) \hat{a}_V(t) \big],
	\end{equation}
are the quantum version of the Stokes vectors defined in Eq.~\eqref{eq:S_intensitydiff}. 
We also define the mode-atom coupling operator
\begin{align}
\hat{\chi}_{pp'} 
&=-\frac{2\pi \omega}{v_g}\mathbf{u}_{p}^*(r'\!_\perp,\phi')\cdot \hat{\tensor{\alpha}}\cdot \mathbf{u}_{p'}(r'\!_\perp,\phi')\\
&= \sum_{f'} \frac{n_g\sigma_0}{4}\frac{\Gamma_{f'}}{\Delta_{ff'}+i\Gamma_{f'}/2}\cdot \left\{ C_{j'ff'}^{(0)}\mathbf{u}_p^*(r'\!_\perp)\cdot \mathbf{u}_{p'}(r'\!_\perp)\hat{\mathbbm{1}}\right.\nn\\
&\quad\quad +iC_{j'ff'}^{(1)}\left(\mathbf{u}_p^*(r'\!_\perp)\times\mathbf{u}_{p'}(r'\!_\perp) \right)\cdot \hat{\mathbf{f}} \nonumber\\
&\quad\quad\left. + C_{j'ff'}^{(2)}\sum_{i,j}\left[u^*_{p,i}u_{p',j}(\frac{\hat{f}_i\hat{f}_j+\hat{f}_j\hat{f}_i}{2}-\frac{\delta_{ij}}{3}\hat{\mathbf{f}}\cdot\hat{\mathbf{f}}) \right]\right\}
%&\left.+C_{jj'ff'}^{(2)}\left[\mathbf{u}_p^*(r'\!_\perp)\cdot \mathbf{u}_{p'}(r'\!_\perp)\left(\frac{f(f+1)}{6}-\frac{m^2}{2} \right)+\mathbf{u}_p^*(r'\!_\perp)\cdot (\hat{e}^*_{\tilde{z}}\hat{e}_{\tilde{z}})\cdot \mathbf{u}_{p'}(r'\!_\perp)\left(\frac{3m^2}{2}-\frac{f(f+1)}{2} \right) \right] \right\}
\label{eq:chippp}
\end{align}
with the horizontally(H)- and vertically(V)-linearly polarized guided modes, $ \mathbf{u}_p(r'\!_\perp) $, at the atom position $ \br'=(r'\!_\perp,\phi',z') $. 
$ \chi_{ij}=\tr[\hat{f}_i\hat{\chi}_j]/(2f+1) $ is the coupling strength between spin operator $ \hat{f}_i $ and Stokes operator $ \hat{S}_j $. 
For example, $ \chi_{33} $ is the coupling strength between $ \hat{f}_z $ and $ \hat{S}_3 $.
The coupling operator or Eq.\eqref{eq:chippp} includes three terms corresponding to scalar, vector and tensor interactions between atoms and the probe light which are proportional to $ C_{j'ff'}^{(K)} $ with $ K=0,\,1,\,2 $, respectively.
These terms may be vanished depending on the state of atoms and the polarization state of the probe defined for the atom-light interaction protocol.

\section{Some special states of an alkali atom}
\subsection{Clock states}

\subsection{Stretched states}


We also ignore the tensor coupling strength related to $ C_{jj'ff'}^{(2)} $ terms in Eq.\eqref{eq:chippp} as the tensor interaction strength ($ \sim 1/\Delta^2 $) is relatively small compared to the vector interaction strength ($ \sim 1/\Delta $)~\cite{Deutsch2010a}. 
For a nanofiber geometry, the Faraday interaction coupling strength is independent of the azimuthal position of the atoms and can be simplified as
\begin{align}
\chi_{33} &= -\sum_{f'}n_g\sigma_0\frac{\Gamma_0}{\Delta_{ff'}+i\Gamma_0/2}C_{jj'ff'}^{(1)}u_{r\!_\perp}(r'\!_\perp)u_\phi(r'\!_\perp)\\
&=\frac{\sigma_0}{A_F}\frac{\Gamma_0}{\Delta_F},
\end{align}
where the effective Faraday interaction mode area $ A_F=1/2n_g|u_{r\!_\perp}(r'\!_\perp)u_\phi(r\!_\perp)| $, and the effective detuning $ \Delta_F=\sum_{f'}\frac{-C_{j'ff'}^{(1)}}{\Delta_{ff'}} $.
The measurement strength is now defined as
\begin{align}
\kappa\equiv|\chi_{33}|^2\dot{N}_L=\frac{\sigma_0A_{in}}{A_F^2}\gamma_s,
\end{align}
where the characteristic photon scattering rate $ \gamma_s\equiv \frac{\Gamma_0\Omega^2}{4\Delta_F}=\frac{\sigma_0}{A_{in}}\frac{\Gamma_0^2}{4\Delta_F^2}\dot{N}_L $ and the effective mode area $ A_{in}=1/n_g|u_{\mathrm{in}}(\br'\!_\perp)|^2 $.
Now we can define the OD per atom for the Faraday interaction using SCS by
\begin{align}
\frac{\mathrm{OD}}{N_A} \equiv \frac{\kappa}{\gamma_s}=\frac{\sigma_0A_{in}}{A_F^2}.
\end{align}





\section{Polarization spectroscopy and quantum nondemolition measurement for alkali atoms}
\subsection{Clock states as the pseudo-spin states for polarimetry}~\footnote{See the NanofiberInterface note and the AFOSRProposal (2010) for related discussions.}
Now, we use the $ f=3,\,m=0 $ and $ f=4,\,m=0 $ two sublevels of $ 6S_{1/2} $ ground state as the psuedo-spin to represent qubit. That is to say, $ \ket{\uparrow}=\ket{f=4,\,m=m_x=0} $ and $ \ket{\downarrow}=\ket{f=3,\,m=m_x=0} $, where we choose the $ x $ axis as the quantization axis. We also launch two orthogonal probe beams notated as mode $ H $ and mode $ V $, whose polarization axes are parallel or perpendicular to the $ x $ axis where the atom is lying in. We can quantize the propagating guided fields with duration $ \tau $ and photon number $ N_L $ as
\begin{align} \label{Eq::FiberModeFunctions}
		\hat{\mathbf{E}}^{(+)}(r\!_\perp,\phi,z) = \sqrt{ \frac{2 \pi \hbar \omega_0}{ v_g \tau} } \big( \mathbf{u}_H(r\!_\perp,\phi) \hat{a}_H + \mathbf{u}_V(r\!_\perp,\phi) \hat{a}_V \big) e^{i \beta z}.
\end{align}
\textcolor{red}{Note: We only consider the forward-propagating fields. Otherwise, it will mess up our results below.}

We are interested in developing a dispersive, state-dependent interface between the collective spin of these atoms and the guided field modes of the fiber.  We first consider the light-shift interaction for a single alkali atom interacting with detuned light in the guided modes of the tapered nanofiber.  Such an interaction is described by the effective Hamiltonian,
\begin{align}  \label{Eq::LightShiftHam}
	H_{\rm eff}   &= -\hat{\mathbf{E}}^{(-)}(r^\prime\!\!_\perp,\phi',z')\cdot \tensor{\alpha}\cdot \hat{\mathbf{E}}^{(+)}(r^\prime\!\!_\perp,\phi',z')\\
	&= -\frac{2\pi \hbar \omega_0}{ v_g\tau} \Big( \mathbf{u}^*_H(r^\prime\!\!_\perp, \phi')\! \cdot\! \tensor{\alpha}\! \cdot\! \mathbf{u}_{H}(r^\prime\!\!_\perp, \phi') \hat{a}\dg_H \hat{a}_H \nonumber\\
	&\quad\quad\quad\quad\quad +  \mathbf{u}^*_V(r^\prime\!\!_\perp, \phi') \!\cdot\! \tensor{\alpha}\! \cdot\! \mathbf{u}_{V}(r^\prime\!\!_\perp, \phi') \hat{a}\dg_V \hat{a}_V \\
	&\quad\quad\quad\quad\quad + \mathbf{u}^*_H(r^\prime\!\!_\perp, \phi') \!\cdot\! \tensor{\alpha}\! \cdot\! \mathbf{u}_{V}(r^\prime\!\!_\perp, \phi') \hat{a}\dg_H \hat{a}_V \nonumber\\
	&\quad\quad\quad\quad\quad + \mathbf{u}^*_V(r^\prime\!\!_\perp, \phi') \!\cdot\! \tensor{\alpha}\! \cdot\! \mathbf{u}_{H}(r^\prime\!\!_\perp, \phi') \hat{a}\dg_V \hat{a}_H \Big), \nonumber 
\end{align}
where the atom is positioned at $ (r^\prime\!\!_\perp,\phi',z') $. 
In the expansion above, the first two terms lead to the \emph{birefringent}\index{birefringence effect} coupling due to the different phase shifts between $ H $ and $ V $ modes. The second two terms lead to the \emph{Faraday}\index{Faraday effect!Faraday coupling} coupling due to a coherent redistribution of photons between $ H $ and $ V $ modes. The polarization dependence of the atom-probe coupling arises from two sources: the tensor nature of $ \tensor{\alpha} $ and the spatial dependence of $ \mathbf{u}_{H}(r\!_\perp, \phi) $ versus $ \mathbf{u}_{V}(r\!_\perp, \phi) $. The amplitude of the $ H $ mode is roughly $ 3 $ times larger than the $ V $ mode on the $ x $ axis. However, in the expression of the Hamiltonian there is always the atomic polarizability multiplied with the modes, which makes it a state-dependent problem. 

Note: alternatively, the effective Hamiltonian can also be rewritten using the irreducible tensor components as
\begin{align}  
H_{\rm eff} &= - \sum_{f,f'}\alpha_0(\Delta_{f,f'}) \left\{ C_{j'ff}^{(0)} \hat{\mathbf{E}}^{(-)} \cdot \hat{\mathbf{E}}^{(+)} \hat{\mathbbm{1}}_f \phantom{\frac{\hat{1}}{1}}\right. \nonumber\\
&\quad\quad\quad + i C_{j'ff'}^{(1)} \left(\hat{\mathbf{E}}^{(-)} \times \hat{\mathbf{E}}^{(+)} \right) \cdot \hat{ \mathbf{f}} \nonumber\\
&\quad\quad\quad  \left. + C_{j'ff}^{(2)} \hat{E}_i^{(-)} \hat{E}_j^{(+)} \left( \frac{ \hat{f}_i \hat{f}_j  + \hat{f}_j \hat{f}_i  }{2} - \frac{1}{3}\delta_{ij} \hat{ \mathbf{f}} \cdot \hat{\mathbf{f}}  \right) \right\}. \label{Eq::LightShiftHam_irep}
\end{align} 

In the weak excitation regime, we limit our attention to the clock state subspace, and hence the polarizability is restricted to the reduced tensor $ \bra{f,m=0}\tensor{\alpha}\ket{f,m=0}$, $f=3,4 $. We can denote such reduced atomic polarizability tensors as 
\begin{align}
\tensor{\alpha}_{\uparrow} &=\bra{f=4,m=0}\tensor{\alpha}\ket{f=4,m=0}\\
\tensor{\alpha}_{\downarrow} &=\bra{f=3,m=0}\tensor{\alpha}\ket{f=3,m=0}.
\end{align}


In the clock state subspace, the vector component of the atomic polarizability is always zeros due to the symmetry of quantum jumps. In the light-shift Hamiltonian expression (Equ.~\eqref{Eq::LightShiftHam}), the crossing terms involving products between both $ H $ and $ V $ modes vanish. 

Now that, the light shift Hamiltonian can be written as 
\begin{align}
H_{\rm eff} & = \frac{ \hbar }{ \tau}\Big( \chi_{H,\uparrow}\op{\uparrow}{\uparrow} +  \chi_{H,\downarrow} \op{\downarrow}{\downarrow} \Big) \hat{a}_H\dg \hat{a}_H \nonumber\\
&\quad +  \frac{ \hbar }{ \tau} \Big( \chi_{V,\uparrow}\op{\uparrow}{\uparrow} +  \chi_{V,\downarrow} \op{\downarrow}{\downarrow} \Big) \hat{a}_V\dg \hat{a}_V  \label{HeffLS}
\end{align}
where the single atom light shifts per photon or the coupling strengths for the different combination of clock states and polarizations are defined as
\begin{align}
\chi_{H,\uparrow} &=  -\frac{2\pi\omega_0}{v_g} \mathbf{u}^*_{H}(r^\prime\!\!_\perp,\phi') \cdot\tensor{\alpha}_{\uparrow}\cdot \mathbf{u}_{H}(r^\prime\!\!_\perp,\phi') \\
\chi_{H,\downarrow} &=  -\frac{2\pi\omega_0}{v_g} \mathbf{u}^*_{H}(r^\prime\!\!_\perp,\phi') \cdot\tensor{\alpha}_{\downarrow}\cdot \mathbf{u}_{H}(r^\prime\!\!_\perp,\phi') \\
\chi_{V,\uparrow} &=  -\frac{2\pi\omega_0}{v_g}  \mathbf{u}^*_{V}(r^\prime\!\!_\perp,\phi') \cdot\tensor{\alpha}_{\uparrow}\cdot \mathbf{u}_{V}(r^\prime\!\!_\perp,\phi')  \\
\chi_{V,\downarrow} &=  -\frac{2\pi\omega_0}{v_g}  \mathbf{u}^*_{V}(r^\prime\!\!_\perp,\phi') \cdot\tensor{\alpha}_{\downarrow}\cdot \mathbf{u}_{V}(r^\prime\!\!_\perp,\phi'). 
\end{align}

Suppose the probe laser is in a near resonance regime of the lower frequency side of the $ D_1 $ line so that the detuning from the ground $ 6S_{1/2} $ $ \ket{f=4} $ hyperfine level to the excited $ 6P_{1/2} $ $ \ket{f=3} $ hyperfine level is far greater than the hyperfine structure splitting of the excited states. We can then ignore the tensor component and the imaginary part of the atomic polarizability, as well as the higher level of excited states above the $ 6P_{1/2} $ energy levels. Baring that the vector component of the polarizability for the clock state vanishes, we only have the scalar coefficient $C_{j' f}^{(0)} =1/3  $ (from Equ.~\eqref{Eq::ScalarCoefSum}) non-zero.~\footnote{Similar case for the $ D_2 $ line will lead to $ C_{j' f}^{(0)} =2/3 $.} Therefore, the atomic polarizability can be given by
\begin{align}
\tensor{\alpha}_{\uparrow} &\approx\sum_{f'=3,4}\frac{\alpha_0(\Delta_{4,f'})}{3}\mathbbm{1} \\
\tensor{\alpha}_{\downarrow} &\approx\sum_{f'=3,4}\frac{\alpha_0(\Delta_{3,f'})}{3}\mathbbm{1},
\end{align}
with $ \alpha_0(\Delta_{f,f'})=-\frac{3\lambda_{j'j}^3}{32\pi^3} \frac{\Gamma}{\Delta_{f,f'}} $. In our case, we can make $ \lambda_{j'j}\approx\lambda= \frac{2\pi c}{\omega_0}$. Therefore, we have
\begin{align}
\frac{2\pi\omega_0}{v_g}\alpha_0(\Delta_{f,f'})=-\frac{n_g\sigma_0}{4} \frac{\Gamma}{\Delta_{f,f'}}
\end{align}
with the 3D atomic scattering cross section $ \sigma_0= \frac{3\lambda^2}{2\pi}  $. 

The coupling strength for the $ D_1 $ line probing can then be written as
\begin{align}
\chi_{H,\uparrow} &=   \frac{1}{2} \sum_{f'} \chi_{H0}(f',4) C_{j',f',4}^{(0)}  =  \frac{1}{2} \sum_{f'} \frac{\chi_{H0}(f',4)}{3} \label{chiHUp}  \\
\chi_{H,\downarrow} &=   \frac{1}{2} \sum_{f'} \chi_{H0}(f',3)  C_{j',f',3}^{(0)} = \frac{1}{2} \sum_{f'} \frac{\chi_{H0}(f',3) }{3} \label{chiHDown}\\
\chi_{V,\uparrow} &=   \frac{1}{2} \sum_{f'} \chi_{V0}(f',4)  C_{j',f',4}^{(0)}  =   \frac{1}{2} \sum_{f'} \frac{\chi_{V0}(f',4)}{3}\label{chiVUp}  \\
\chi_{V,\downarrow} &=   \frac{1}{2} \sum_{f'} \chi_{V0}(f',3)  C_{j',f',3}^{(0)}=   \frac{1}{2} \sum_{f'} \frac{\chi_{V0}(f',3) }{3} \label{chiVDown}
\end{align}
and 
\begin{align}
\chi_{H0}(f',f) &= \left( \frac{ \sigma_0}{A_{ef\!f}^H} \right) \left( \frac{\Gamma}{2 \Delta_{f,f'}} \right)\\
\chi_{V0}(f',f) &= \left( \frac{ \sigma_0}{A_{ef\!f}^V} \right) \left( \frac{\Gamma}{2 \Delta_{f,f'}} \right)\\
A_{ef\!f}^H &= \frac{1}{n_g|\mathbf{u}_{H}(r^\prime\!\!_\perp,\phi')|^2}\\
A_{ef\!f}^V &= \frac{1}{n_g | \mathbf{u}_{V}(r^\prime\!\!_\perp,\phi')|^2}.\label{eq:AeffV}
\end{align}
Considering the relationship between $ \Gamma_{1D} $ and $ \Gamma_{vac} $ (the same as the $ \Gamma $ above) from Equ.~\eqref{Gamma1DGammavac}, Equs.~\eqref{chiHUp} and~\eqref{chiHDown} are equivalent to Equ.~\eqref{phaseshiftGamma1D} derived from the Green's function method with scalar polarizability. The scalar polarizability factor of $ C_{j',f',f}^{(0)}=\frac{1}{3} $ in Equ.~\eqref{chiHUp} through Equ.~\eqref{chiVDown} indicates the possibility of transitions back to the clock state. This factor can be absorbed into the atomic scattering cross section by treating the scattering cross section as an average over all possible quantum transitions. 

\subsection{Full Hamiltonian using Clebsch-Gordan coefficients}
We can also work in the time-domain to include the wave-propagation process much carefully. \textcolor{red}{Note: part of the content below is directly from Ben's notes.}

For the nanofiber interface, we specify to the single-mode condition that only the HE$_{11}$ spatial mode propagates in the fiber with propagation constant $\beta_0$.  We can further make the first Markov approximation that the coupling is dominated by frequencies near an atomic transition frequency $\omega_0$ and then extend the limit of integration to $-\infty$ as a mathematical convenience.  We then define Fourier-transformed \emph{input-output field operators} that describe propagating modes in the nanofiber,
	\begin{align}
		\hat{a}_{\mu}(z,t) \equiv \frac{1}{\sqrt{2\pi}} \int_{-\infty}^{\infty} \mathrm{d}\omega \hat{a}_{\mu}(\omega) e^{i f \beta_0 z -i\omega_0 t}.
	\end{align}	
They satisfy the white-noise commutation relations
	\begin{align}
		[\hat{a}_{\mu}(z,t), \hat{a}\dg_{\mu'}(z',t')] = \delta_{p,p'} \delta_{f,f'} \delta(t-t' - |z-z'|/v_p).
	\end{align}	
Note that the commutation relation is related to the \emph{phase retarded time} which is related to the phase velocity, $v_p = \omega_0/\beta_0$, rather than the group velocity.  More details on this can be found in several of Le Kien's papers, including \emph{Correlations between photons emitted by multi-atom fluorescence into a nanofiber} (http://journals.aps.org/pra/pdf/10.1103/PhysRevA.77.033826).

The guided-mode electric field operator can then be written in terms of the input-output field operators
	\begin{align}\label{eq:Ebp}
		\hat{\mathbf{E}}_g^{(+)}(\mathbf{r}) = \sum_{f ,p} \sqrt{\frac{2 \pi \hbar \omega_0}{v_g}} \hat{a}_{\mu}(z,t) \mathbf{u}_{\mu}(\mathbf{r}_\perp) 
	\end{align}
We have dropped the $\omega(\beta)$ label on the mode functions as it is only for the fundamental propagation constant $\beta_0$.

Atoms can be trapped around the surface of the nanofiber using a handful of techniques.  In the interaction Hamiltonian $z=z' =z_A$ for the two field operators that appear, so we drop the $z$ label on the field operators $\hat{a}(z,t) \rightarrow \hat{a}(t)$.  This will not in general be valid when calculating the output propagating field operators, as their interaction will depend on the positions of the multiple atoms throughout the ensemble.  However, we make the assumption that the transit time through the nanofiber region is short compared to the collective atomic dynamics, and thus we can ignore the retarded group time.  

From Equ.~\eqref{Eq::LightShiftHam}, the effective Hamiltonian of the light-atom interaction at time $ t $ can then be given by
\begin{align}  
	H_{\rm eff}   = -\frac{2\pi \hbar \omega_0}{ v_g } &\Big( \mathbf{u}^*_H(r^\prime\!_\perp, \phi') 
	\!\cdot\! 
	\tensor{\alpha} \!\cdot\! \mathbf{u}_{H}(r^\prime\!_\perp, \phi') \hat{a}\dg_H(t) \hat{a}_H(t) \nonumber\\
	&\!\! +  
	\mathbf{u}^*_V(r^\prime\!_\perp, \phi')\! \cdot\! 
	\tensor{\alpha} \!\cdot\! \mathbf{u}_{V}(r^\prime\!_\perp, \phi') \hat{a}\dg_V(t) \hat{a}_V(t) \nonumber\\
	&\!\! + \mathbf{u}^*_H(r^\prime\!_\perp, \phi')\! \cdot\! \tensor{\alpha}\! \cdot\! 
	\mathbf{u}_{V}(r^\prime\!_\perp, \phi') \hat{a}\dg_H(t) \hat{a}_V(t) \nonumber\\
	&\!\! + \mathbf{u}^*_V(r^\prime\!_\perp, \phi') \!\cdot\! \tensor{\alpha}\! \cdot\! 
	\mathbf{u}_{H}(r^\prime\!_\perp, 
	\phi') \hat{a}\dg_V(t) \hat{a}_H(t) 
	\Big).  \label{eq:LightShiftHam_CG}
\end{align}
The atomic polarizability tensor $\tensor{\alpha}$\index{polarizability!polarizability tensor} is composed of a dyad of vector dipole operators,    
\begin{align}
	\tensor{\alpha} & =  - \frac{1}{\hbar}  \sum_{F,F'} \frac{ \mathbf{d}_{FF'} \mathbf{d}^\dagger_{F'F} 
	}{\Delta_{FF'}+i\frac{\Gamma}{2} } \\
		& = \sum_{q,q'}  \sum_{F,F'} \sum_{m_1, m_2, m'} \!\!\!\!\!\! \alpha_0(F,F') \mathbf{e}_q \otimes 
		\mathbf{e}^*_{q'} | o^{J'F'}_{JF} |^2 C^{Fm_2;1q}_{F'm'} C^{Fm_1;1q'}_{F'm'} \op{F m_2}{F m_1},
\end{align}
with the vector raising  dipole operator,
\begin{align}
	\mathbf{d}^\dagger_{F'F} =  \bra{P_{J'}}| d |\ket{S_{1/2}} \sum_q \sum_{m,m'} \mathbf{e}_q^* 
	o^{J'F'}_{JF} C^{Fm;1q}_{F'm'} \op{F'm'}{Fm}
\end{align}
where $o^{J'F'}_{JF}$ is the oscillator strength from Ref. \cite{Deutsch2010a} and $C^{Fm;1q}_{F'm'} 
\equiv 
\ip{F'm'}{Fm;1q}$ is a Clebsch-Gordan coefficient. 
Notice that $m' = m_1 + q'$ and $m' = m_2 + q$ and thus
\begin{align}
	m_2 - m_1 = q-q'.
\end{align}
The characteristic polarizability\index{polarizability!characteristic polarizability} is
\begin{align} \label{eq:CharacteristicPolarizability}
	\alpha_0(F,F') = - \frac{ |\bra{P_{J'}}| d |\ket{S_{1/2}}|^2 }{\hbar (\Delta_{F,F'}+i\frac{\Gamma}{2})} = - 
	\frac{3 
	\lambda_{J'}^3}{32 \pi^3} \frac{\Gamma}{\Delta_{F,F'}+i\frac{\Gamma}{2}}.
\end{align}
and the detuning is defined as
\begin{align}
	\Delta_{FF'} \equiv \omega - (\omega_{F'} - \omega_{F}).
\end{align}
Due to the hyperfine ground splitting in Cs$^{133}$ of approximately 9.2 GHz, the characteristic 
polarizabilities for the two ground hyperfine manifolds, \erf{eq:CharacteristicPolarizability}, can in 
general have different magnitudes and signs.  Implied in the expression above is that we have chosen a 
$J'$ transition - generally $S_{1/2} \rightarrow P_{1/2}$ ($D_1$) or $S_{1/2} \rightarrow P_{3/2}$ ($D_2$), 
which are 
separated by tens of THz and thus quite resolvable.   

Now suppose that rather than using the magnetic sublevels within a single ground hyperfine state $F$ as 
in Ref.~\cite{Deutsch2010a}, we begin with a dispersive interface defined on the $m=0$ ``\emph{clock}" states 
between the $F=3$ and $F=4$ hyperfine states.  To first order such states are insensitive to ambient 
magnetic field fluctuations.  In the clock-state subspace, we designate the qubit states
\begin{align} 
	\ket{\uparrow} &\equiv \ket{F = 4,m_F = 0} \\
 	\ket{\downarrow} &\equiv \ket{F = 3,m_F=0}.
\end{align}
The light shift Hamiltonian, \erf{eq:LightShiftHam_CG}, can then be expressed in this basis by finding 
the 
matrix elements between our relevant states.  Since the atomic polarizability tensor is block-diagonal in 
the ground hyperfine states, we need only consider coupling between the states within the same 
manifold.  
For instance, we may have a $H-V$ mode crossing term like
\begin{align} \label{eq:ClockMatrixElement}
	&\bra{F,0} \mathbf{u}^*_H(r^\prime\!_\perp, \phi') \cdot \tensor{\alpha} \cdot 
	\mathbf{u}_{V}(r^\prime\!_\perp, \phi') \ket{F,0}\nonumber\\
  =& 
	\sum_{F'} \sum_{m'} \sum_{q, q'} \alpha_0(F,F') \big( \mathbf{e}_q \cdot 
	\mathbf{u}^*_H(r^\prime\!_\perp, \phi') \big) 
	\big( \mathbf{e}^*_{q'} \cdot \mathbf{u}_V(r^\prime\!_\perp, \phi') \big) |o^{J'F'}_{JF} |^2 C^{F 0;1 
	q}_{F' m'} C^{F 
	0;1q'}_{F' m'} \\
 = & \sum_{F'} \sum_{q} \alpha_0(F,F') \big( \mathbf{e}_q \cdot \mathbf{u}^*_H(r^\prime\!_\perp, \phi') 
	\big) \big( 
	\mathbf{e}^*_{q} \cdot \mathbf{u}_V(r^\prime\!_\perp, \phi') \big) |o^{J'F'}_{JF} |^2 C^{F 0;1q}_{F' q} 
	C^{F 0;1q}_{F' q}.
\end{align}
since $q+q' = 0$ and for the clock states $m' = q'$. By the nature of the nanofiber modes, if we choose 
$V$-mode polarization axis or the $y$ axis to be the quantization axis, then with the atoms positioned 
along the $x$ axis, the crossing term above always cancels. The same conclusion casts to other mode crossing 
terms. In fact, the conclusion above does not depend on the choice of basis. We can show that by 
rewriting the equations above as
\begin{align}
&\bra{F,0} \mathbf{u}^*_H(r^\prime\!_\perp, \phi') \cdot \tensor{\alpha} \cdot 
	\mathbf{u}_{V}(r^\prime\!_\perp, \phi') \ket{F,0}\nonumber\\
=& \mathbf{u}^*_H(r^\prime\!_\perp, 
 \phi')\cdot \left[  \sum_{q} \sum_{F'}\alpha_0(F,F') 
   |o^{J'F'}_{JF} |^2 C^{F 	0;1q}_{F' q} C^{F 0;1q}_{F' q}
     	  \mathbf{e}_q \mathbf{e}^*_{q}  \right]\cdot \mathbf{u}_V(r^\prime\!_\perp, \phi') \\
=& \mathbf{u}^*_H(r^\prime\!_\perp,  \phi')\cdot \boldsymbol{\alpha}^{F0;F0}]\cdot 
\mathbf{u}_V(r^\prime\!_\perp, \phi') \\
=& \tr\left[ \left(  \mathbf{u}_V(r^\prime\!_\perp, \phi')  \mathbf{u}^*_H(r^\prime\!_\perp,  \phi')\right)
\cdot  \boldsymbol{\alpha}^{F0;F0} \right],
\end{align}
where $  \boldsymbol{\alpha}^{F0;F0} = \bra{F,0}\boldsymbol{\alpha}\ket{F,0} = \sum_{q} 
\sum_{F'}\alpha_0(F,F') 
   |o^{J'F'}_{JF} |^2 C^{F 	0;1q}_{F' q} C^{F 0;1q}_{F' q}
     	  \mathbf{e}_q \mathbf{e}^*_{q} $ is the atomic 
polarizability tensor restricted to the $ (F,m_F=0) $ atomic space. The first block inside of the big bracket 
is a dyad. Obviously, the result as a trace does not depend on how we rotate the basis inside. 
% by 
%$\tr\left[ \mathbf{P} \left(  \mathbf{u}_V(r^\prime\!_\perp, \phi')  \mathbf{u}^*_H(r^\prime\!_\perp,  
%\phi')\right) \mathbf{P}^{-1}
%\cdot \mathbf{P}  \boldsymbol{\alpha}^{F0;F0}\mathbf{P}^{-1} \right]  $, where $ \mathbf{P} $ is the 
%rotation matrix. 
 
We stick to the choice of quantization axis used above, and have
\begin{align}
H_{\rm eff} & =  \hbar \Big( \chi_{H,\uparrow}\op{\uparrow}{\uparrow} +  
\chi_{H,\downarrow} \op{\downarrow}{\downarrow} \Big) \hat{a}_H\dg(t) \hat{a}_H(t) \nonumber\\
&\quad +  \hbar  \Big( \chi_{V,\uparrow}\op{\uparrow}{\uparrow} +  \chi_{V,\downarrow} 
\op{\downarrow}{\downarrow} \Big) \hat{a}_V\dg(t) \hat{a}_V(t)  ,\label{eq:Heffupdown}
\end{align}
where the coupling strengths are defined as
\begin{align}
\chi_{H,\uparrow} &=  -\frac{2\pi\omega_0}{v_g} \bra{F=4,m=0} 
\mathbf{u}^*_{H}(r^\prime\!\!_\perp,\phi') \!\cdot\!\tensor{\alpha}\!\cdot\! 
\mathbf{u}_{H}(r^\prime\!\!_\perp,\phi') \ket{F=4,m=0}\\
\chi_{H,\downarrow} &=  -\frac{2\pi\omega_0}{v_g}  \bra{F=3,m=0} 
\mathbf{u}^*_{H}(r^\prime\!\!_\perp,\phi') \!\cdot\!\tensor{\alpha}\!\cdot\! 
\mathbf{u}_{H}(r^\prime\!\!_\perp,\phi') \ket{F=3,m=0} \\
\chi_{V,\uparrow} &=  -\frac{2\pi\omega_0}{v_g}   \bra{F=4,m=0} 
\mathbf{u}^*_{V}(r^\prime\!\!_\perp,\phi') \!\cdot\!\tensor{\alpha}\!\cdot\! 
\mathbf{u}_{V}(r^\prime\!\!_\perp,\phi') \ket{F=4,m=0}  \\
\chi_{V,\downarrow} &=  -\frac{2\pi\omega_0}{v_g}  \bra{F=3,m=0} 
\mathbf{u}^*_{V}(r^\prime\!\!_\perp,\phi') \!\cdot\!\tensor{\alpha}\!\cdot\! 
\mathbf{u}_{V}(r^\prime\!\!_\perp,\phi') \ket{F=3,m=0}. 
\end{align}

To write down the Hamiltonian in the clock space,
\begin{align}
\chi_{H,\uparrow/\downarrow} & \equiv \chi_{H,F} =- \frac{2\pi \omega_0}{v_g} \bra{F,0} 
	\mathbf{u}^*_H(r^\prime\!_\perp, \phi') \cdot \tensor{\alpha} \cdot 
	\mathbf{u}_{H}(r^\prime\!_\perp, 
	\phi') \ket{F,0} \\
	& =- \frac{2\pi \omega_0}{v_g} \sum_{F'} \sum_q \alpha_0\left( F,F'  \right) |\mathbf{e}_q \cdot 
	\mathbf{u}_H^*(r^\prime\!_\perp,\phi')|^2 |o^{J'F'}_{JF} |^2 
	|C^{F 0;1q}_{F' q}|^2\\
	& \approx  \left( \sigma_0 n_g  \right)  \sum_q \sum_{F'} \left( 
		\frac{\Gamma}{4 
		\left(\Delta_{F,F'}+i\Gamma/2\right) }  \right) |\mathbf{e}_q \cdot 
		\mathbf{u}_H^*(r^\prime\!_\perp,\phi')|^2 |o^{J'F'}_{JF} |^2 
		|C^{F 0;1q}_{F' q}|^2,\label{eq:chiHeu}\\
\chi_{V,\uparrow/\downarrow} & \equiv \chi_{V,F} =- \frac{2\pi \omega_0}{v_g} \bra{F,0} 
	\mathbf{u}^*_V(r^\prime\!_\perp, \phi') \cdot \tensor{\alpha} \cdot 
	\mathbf{u}_{V}(r^\prime\!_\perp, 
	\phi') \ket{F,0} \\
	& =- \frac{2\pi \omega_0}{v_g} \sum_{F'} \sum_q \alpha_0\left( F,F'  \right) |\mathbf{e}_q \cdot 
	\mathbf{u}_V^*(r^\prime\!_\perp,\phi')|^2 |o^{J'F'}_{JF} |^2 
	|C^{F 0;1q}_{F' q}|^2\\
	& \approx   \left( \sigma_0 n_g  \right)  \sum_q\sum_{F'} \left( 
		\frac{\Gamma}{4 
		\left(\Delta_{F,F'}+i\Gamma/2\right) }  \right) |\mathbf{e}_q \cdot 
		\mathbf{u}_V^*(r^\prime\!_\perp,\phi')|^2 |o^{J'F'}_{JF} |^2 
		|C^{F 0;1q}_{F' q}|^2,\label{eq:chiVeu}
\end{align}
where we have approximated $ \lambda_{J'}\approx \lambda = \frac{2\pi c}{\omega_0} $.  We can also 
rewrite the result above in terms of dyadic Green's functions\index{Green's function!dyadic Green's function} and tensor polarizabilities\index{polarizability!polarizability tensor} as
\begin{align}
\chi_{H,\uparrow/\downarrow} & \equiv \chi_{H,F} = 4\pi k_0^2 \tr \left\{ \mathrm{Im}\left[ 
\mathbf{G}^*_{HH}(\br^\prime\!_\perp,\br^\prime\!_\perp) \right] \cdot \boldsymbol{\alpha}^{F0;F0} 
\right\}\label{eq:chiHGalpha}\\
\chi_{V,\uparrow/\downarrow} & \equiv \chi_{V,F} = 4\pi k_0^2 \tr \left\{ \mathrm{Im}\left[ 
\mathbf{G}^*_{VV}(\br^\prime\!_\perp,\br^\prime\!_\perp) \right] \cdot \boldsymbol{\alpha}^{F0;F0} 
\right\},\label{eq:chiGalpha}
\end{align}
where 
\begin{align} 
\!\!\!\! \mathbf{G}_{HH/VV}(\br',\br') &= -\frac{in_g}{2k_0} 
\mathbf{u}_{H/V}(r^\prime\!_\perp,\phi')\mathbf{u}_{H/V}^*(r^\prime\!_\perp,\phi')\\
\boldsymbol{\alpha}^{F0;F0} &\approx \frac{\sigma_0\lambda_{J'}}{4\pi^2}  \sum_q \sum_{F'} \left( 
		\frac{\Gamma}{4 
		\left(\Delta_{F,F'}+i\Gamma/2\right) }  \right)   |o^{J'F'}_{JF} |^2 
		|C^{F 0;1q}_{F' q}|^2  \mathbf{e}_q \mathbf{e}_q^*.
\end{align}
 
% Rewrite the Hamiltonian in the Stokes and collective spin representation. 
\section{Spin squeezing induced by QND measurement}

Now, we consider to rewrite the Hamiltonian in terms of the Stokes vector operators and the collective spin operators with the total atom number of $ N_A $. We assume the photon number, $ N_L $, is large and all atoms interact with the photon package at the same time, and hence interactions among atoms and the interference effect due to photon propagation are ignored during every measurement time step. 

The polarization state of the light can be represented on the \Poincare sphere via Stokes vector $ \mathbf{S} $. The quantized operators in the Schwinger representation with respect to the three \Poincare sphere axes are defined as  
\begin{subequations}\label{eq:SopinaHVbasis}
\begin{align}
\hat{S}_1(z,t)&= \frac{1}{2} \Big( \hat{a}_H\dg(z,t) \hat{a}_H(z,t) -  \hat{a}_V\dg(z,t) \hat{a}_V(z,t) \Big) \\
\hat{S}_2(z,t)&= \frac{1}{2} \Big( \hat{a}_H\dg(z,t) \hat{a}_V(z,t) +  \hat{a}_V\dg(z,t) \hat{a}_H(z,t) \Big)\\
\hat{S}_3(z,t)&= \frac{1}{2i} \Big( \hat{a}_H\dg(z,t) \hat{a}_V(z,t) -  \hat{a}_V\dg(z,t) \hat{a}_H(z,t) \Big)
\end{align}
\end{subequations}
satisfying the $ SU(2) $ algebra $ [S_i(z,t),S_j(z',t')]=i\varepsilon_{ijk}S_k(z,t)\delta (t-t' - (z-z')/c ) $. The total number operator is defined as
\begin{align}
\hat{S}_0(z,t)&= \frac{1}{2} \Big( \hat{a}_H\dg(z,t) \hat{a}_H(z,t) +  \hat{a}_V\dg(z,t) \hat{a}_V(z,t) \Big).
\end{align}

We define the pseudo-spin operator in the corresponding subspace for one atom is defined as $ \mathbf{j}=\frac{\boldsymbol{\sigma}}{2} $. We will use  the following spin components, which can be expressed as
\begin{align}
\hat{j}_z &= \frac{1}{2} \Big( \op{\uparrow}{\uparrow} - \op{\downarrow}{\downarrow}  \Big), \\
\hat{j}_0 &= \frac{1}{2} \Big( \op{\uparrow}{\uparrow} + \op{\downarrow}{\downarrow}  \Big).
\end{align}
The quantization axis is chosen to be the $ x $ axis. For a collective spin system with $ N_A $ atoms, the pseudo-spin angular momentum operator can be defined as
\begin{align}
\mathbf{J} &=\sum_i^{N_A}\mathbf{j}^{(i)}=\frac{1}{2}\sum_i^{N_A} \boldsymbol{\sigma}^{(i)}\\
\mathbf{J}_+ &=\sum_i^{N_A} \boldsymbol{\sigma}^{(i)}_+.
\end{align}
The maximum possible angular momentum is $ J=\frac{N_A}{2} $. Each $ J_z $ measurement will yield an eigenvalue ranging from $ -\frac{N_A}{2} $ to $ \frac{N_A}{2} $.  This subspace is unique with dimension $ D=2J+1=N_A+1 $, and is symmetric with respect to exchange of any two individual spins. The different total $ J $'s of the collective spin-$ \frac{1}{2} $ system support "irreducible" matrix representation of the $ SU(2) $ group. The spin operator components satisfy the commutator relationship that $ [J_i,J_j]=i\varepsilon_{ijk}J_k $. Therefore, any pair of the spin operators obey the Heisenberg uncertainty relationship which--for $ \Delta J_x^2 $ and $ \Delta J_y^2 $--is given by 
\begin{align}
\Delta J_x^2\Delta J_y^2 &\ge \frac{1}{4}\langle J_z^2\rangle \\
\expect{\Delta J_x} &=\expect{\Delta J_y}=\expect{\Delta J_{\perp}}=\sqrt{\frac{J(J+1)-M^2}{2}}.
\end{align}
The minimum uncertainty for $ \ket{J,M=\pm J} $ gives $ \Delta J_\perp=\Delta J_x=\Delta J_y = \sqrt{\frac{J}{2}} $ while $ \expect{J_\parallel}=\expect{J_z^2}=M^2=J^2 $. 

For now, we consider the birefringence measurement with an initial input laser polarization state of $ \vec{D}=\left( \vec{H}+\vec{V}\right)/\sqrt{2} $ which is pointing along $ S_2 $ direction on the \Poincare sphere. For a large number of photon incidence, we can set 
\begin{subequations}\label{eqs:cohaHV}
\begin{align}
\hat{a}_H &\rightarrow i\sqrt{\frac{\dot{N}_L}{2}} + \hat{a}_H\\
\hat{a}_V &\rightarrow i\sqrt{\frac{\dot{N}_L}{2}} + \hat{a}_V,
\end{align}
\end{subequations}
where each operator has a classical photon flux number and a quantum operator to indicate the quantum fluctuation of the photon flux. In the case of $ \dot{N}_L\gg \sqrt{\dot{N}_L}\gg 1 $, the Stokes operators can be given by
\begin{align}
\hat{S}_1 &= \frac{1}{2}\left[ \Big( -i\sqrt{\frac{\dot{N}_L}{2}} + \hat{a}_H\dg \Big) \Big( i\sqrt{\frac{\dot{N}_L}{2}} + \hat{a}_H\Big) -  \Big( -i\sqrt{\frac{\dot{N}_L}{2}} + \hat{a}_V\dg\Big)  \Big(i\sqrt{\frac{\dot{N}_L}{2}} + \hat{a}_V \Big) \right]\\
&= \sqrt{\frac{\dot{N}_L}{2}} \frac{i}{\sqrt{2}} \left[\frac{\hat{a}_H\dg-\hat{a}_V\dg}{\sqrt{2}} - \frac{\hat{a}_H-\hat{a}_V}{\sqrt{2}} \right] + \frac{1}{2} \Big( \hat{a}_H\dg \hat{a}_H -  \hat{a}_V\dg \hat{a}_V \Big)\\
&\approx \sqrt{\frac{\dot{N}_L}{2}} \frac{i}{\sqrt{2}} \left( \hat{a}_{\bar{D}}\dg-\hat{a}_{\bar{D}}\right)\\
&= \sqrt{\frac{\dot{N}_L}{2}} \hat{P}_{\bar{D}},\\
\hat{S}_3 &= \frac{1}{2i} \left[ \Big( -i\sqrt{\frac{\dot{N}_L}{2}} + \hat{a}_H\dg \Big) \Big(i\sqrt{\frac{\dot{N}_L}{2}} + \hat{a}_V \Big) -  \Big( -i\sqrt{\frac{\dot{N}_L}{2}} + \hat{a}_V\dg\Big) \Big( i\sqrt{\frac{\dot{N}_L}{2}} + \hat{a}_H\Big) \right]\\
&= \sqrt{\frac{\dot{N}_L}{2}}  \frac{1}{\sqrt{2}}\left[ \frac{\hat{a}_H\dg-\hat{a}_V\dg}{\sqrt{2}} + \frac{\hat{a}_H-\hat{a}_V}{\sqrt{2}} \right] +\frac{1}{2i} \Big( \hat{a}_H\dg \hat{a}_V -  \hat{a}_V\dg \hat{a}_H \Big)\\
&\approx \sqrt{\frac{\dot{N}_L}{2}} \hat{X}_{\bar{D}},\\
\hat{S}_2 &\approx \frac{\dot{N}_L}{2},\\
\hat{S}_0 &\approx \frac{\dot{N}_L}{2},
\end{align}
where we have defined $ \hat{a}_{\bar{D}} = \frac{\hat{a}_H -\hat{a}_V}{\sqrt{2}} $ as the photon annihilation operator of the anti-diagonal linearly polarized light modes, and $ \hat{P}_{\bar{D}}=\frac{\hat{a}_{\bar{D}}-\hat{a}_{\bar{D}\dg}}{i\sqrt{2}} $ and $ \hat{X}_{\bar{D}}=\frac{\hat{a}_{\bar{D}}+\hat{a}_{\bar{D}\dg}}{\sqrt{2}} $ as the two quadratures in the phase space of the complex amplitude represented by $ \hat{a}_{\bar{D}} $. The approximation we made above is known as \emph{Holstein-Primakoff approximation}\index{approximation!Holstein-Primakoff approximation}. Using this approximation, the uncertainty area on the \Poincare sphere can be mapped to a flat phase plane. 


Notice that, the $ \hat{S}_1 $ and $ \hat{S}_3 $ still satisfy the usual $ SU(2) $ Lie algebra relationship that 
\begin{align}
[\hat{S}_3,\hat{S}_1] = i \hat{S}_2 \approx i\frac{\dot{N}_L}{2}
\end{align}
which is important for us to choose $ \hat{S}_1 $ as the rotation axis and $ \hat{S}_3 $ as the observation axis on the \Poincare sphere for our QND measurement as will be discussed later. 



Similarly, when the atom number is large, one can also map the angular momentum/spin operators to the quadrature operators. However, we will try to avoid applying this approximation to the spin operators, since the total number of the atoms are not too large in the context of the nanofiber platform. 



\subsubsection{Spin coherent states and spin squeezing through weak measurements}
Spin coherent states are the most classical-like quantum state of a collective spin system, which has maximum projection along some axis $ \hat{\mathbf{n}} $. For example, we consider a $ N $-spin-$ \frac{1}{2} $ system in a spin coherent state (SCS) with all spins in $ \ket{\uparrow} $ along $ x $ axis:
\begin{subequations}\label{eq:SCSJx}
\begin{align}
\ket{J,M_x=J} &=\ket{\uparrow_x}^{\otimes N} = \left(\frac{\ket{\uparrow}+\ket{\downarrow}}{\sqrt{2}}\right)^{\otimes N}\\
&= \sum_{M=-J}^J \left( \begin{matrix}N\\ M \end{matrix} \right) \left( \frac{1}{\sqrt{2}}\right)^{N-M} \left( \frac{1}{\sqrt{2}}\right)^{M} \ket{J,M}
\end{align}
\end{subequations}
which is a Binomial distribution of all eigenstates $ \ket{J,M} $. Notice that, the $ \ket{J,M} $ with $ |M|<J $ are known as the "Dicke states". 
When $ N $ is large, this Binomial distribution becomes a Gaussian based on the central limit theorem. As a concrete example, we can consider $ N=2 $ case of SCS:
\begin{align}
\ket{\uparrow_x}^{\otimes 2} &= \left(\frac{\ket{\uparrow}+\ket{\downarrow}}{\sqrt{2}}\right)^{\otimes 2}\\
&= \frac{1}{2}\ket{\uparrow\uparrow} +\frac{1}{\sqrt{2}}\left(\frac{\ket{\uparrow\downarrow}+\ket{\downarrow\uparrow}}{\sqrt{2}} \right) + \frac{1}{2}\ket{\downarrow\downarrow}\\
&= \frac{1}{2}\ket{1,1}+\frac{1}{\sqrt{2}}\ket{1,0}+\frac{1}{2}\ket{1,-1}.
\end{align}
Therefore, if we apply a $ J_z $ measurement, we will have a possibility distribution of obtaining $ \pm 1 $ and $ 0 $ with $ P(\pm 1)=\frac{1}{4} $ and $ P(0)=\frac{1}{2} $. As $ N $ increases, the possibility distribution eventually becomes a Gaussian shape, the width of which characterizes the uncertainty of the $ J_z $ measurement. 

\textcolor{red}{Better to have a measurement distribution plot here.}

In general, a SCS can be treated as a rotated state from the stretched state $ \ket{J,-J} $ (\textcolor{red}{need a plot of the Bloch sphere here}):
\begin{align}
\ket{\theta,\phi} \equiv \hat{D}_{\theta,\phi} \ket{J,-J},
\end{align} 
where the rotation operator with rotation angle $ (\theta,\phi) $ is defined as
\begin{align}
\hat{D}_{\theta,\phi} =e^{-i\theta\hat{n}\cdot \mathbf{J}}=e^{-i\theta (\hat{J}_x\sin \phi - \hat{J}_y\cos \phi) }. 
\end{align}
Note: for the stretched state along $ \hat{n}_{\theta,\phi} $, $ \hat{n}_{\theta,\phi}\cdot \mathbf{J}\ket{\theta,\phi}=-J\ket{\theta,\phi} $. 

In terms of the standard basis, $ \left\{ \ket{J,M} \right\} $,
\begin{align}
\ket{\theta,\phi} =\sum_{M=-J}^J \frac{\tau^{M+J}}{(1+|\tau|^2)^J} \left( \begin{matrix} 2J\\ M+J\end{matrix}\right)^{1/2} \ket{J,M},
\end{align} 
where $ \tau = \tan \frac{\theta}{2}e^{-i\phi} $. 

When $ \theta=\frac{\pi}{2} $, $ \tau=\frac{1}{\sqrt{2}}e^{-i\phi} $, $ J_z =0$ and the probability distribution of magnetic sublevels obeys the binomial distribution of a fair coin as shown in the example earlier. (\textcolor{red}{Need a plot of $ P_M $ here.}) 
\begin{align}
P_M &= |\bravket{J,M}{\theta=\frac{\pi}{2}}|^2\\
&=\left( \begin{matrix} 2J\\ M+J\end{matrix}\right) \left(\frac{1}{2} \right)^{2J}\left(\frac{1}{2} \right)^{M+J} \Rightarrow \frac{1}{\sqrt{\pi J}} e^{-\frac{M^2}{J}} \quad \text{for} J\rightarrow\infty.
\end{align}
The central limit theorem was applied in the last step to retrieve the Gaussian distribution function with mean zero and variance $ J/2 $. As can be seen, the SCS gives the minimum uncertainty for the $ J_\perp $:
\begin{align}
\expect{\Delta J_\perp} &= \frac{J}{2}=\frac{N}{4}.
\end{align} 
This is known as the \emph{shot noise limit}\index{noise!short noise limit}. 

Since one can present the density operator of the collective spin state onto the spin coherent basis, 
\begin{align}
\hat{\rho} &= \int P(\theta,\phi) \ketbra{\theta,\phi} \mathrm{d}\Omega ,
\end{align}
where $ \mathrm{d}\Omega=\sin\theta \mathrm{d}\theta \mathrm{d}\phi $ is the solid angle differential element, and $ P(\theta,\phi) $ is the probability distribution function. In our case, we only consider SCS and spin squeezed states, both of which are Gaussian. The typical representations like P-representation, Q-representation and Wigner-representation of those states are always positive and Gaussian. One can pick anyone of the representations to visualize the probability distribution as a function of $ (\theta,\phi) $ on a generalized Block sphere for the $ 2J+1 $ dimensional collective spin state space. In contrast to the usual Bloch sphere mapping the spin-$ \frac{1}{2} $ or qubit states, the position of the collective spin state on the the generalized Bloch sphere only indicates the mean spin direction and its fluctuation.  In the SCS case, the isotropic angular uncertainty on the generalized Bloch sphere $ \Delta \phi=\Delta \theta $, and can be defined by the ratio of the uncertainty of the perpendicular spin direction $ \Delta J_\perp $ to the mean spin length $ J $:
\begin{align}
\Delta \phi = \frac{\Delta J_\perp }{\expect{J}} = \frac{1}{\sqrt{2J}}=\frac{1}{\sqrt{N}}.
\end{align} 
This limit arises as the classical statistical limit in a system consisting of $ N $ independent particles, and is known as the \emph{standard quantum limit}\index{noise!standard quantum limit}. 

For the SCS, the uncertainties of any two orthogonal angular momentum components that is perpendicular to the spin direction are equal and reaches the minimum value of $ \sqrt{J/2} $. 
 
The collective spin state becomes a spin squeezed state (SSS) when the uncertainties of two orthogonal angular momentum components differ from each other and satisfy
\begin{align}
\Delta J_{\perp_1} \Delta J_{\perp_2} &= \frac{J}{2}\\
\Delta J_{\perp_1} = \Delta J_{\perp,min} &< \sqrt{J/2},
\end{align}
where $ \Delta J_{\perp_1} = \Delta J_{\perp,min} $ and $ \Delta J_{\perp_2} = \Delta J_{\perp,max} $ are the two principle axis of the uncertainty shadow on the generalized Bloch sphere. 

A SSS can be created by the nonlinear effect of measurement backaction. We can model this by a weak measurement of one spin component, defined by the Kraus operators
\begin{align}\label{KrausOpSq}
\hat{A}_m &= \frac{1}{(2\pi \sigma^2)^{1/4}} e^{-\frac{(m-\hat{J}_z)^2}{4\sigma^2}}
\end{align}
where $ \sigma  $ is the variance of the measurement and defines the resolution of measurement. Given an input state $ \ket{\Psi}_{in} $, the post measurement state becomes
\begin{align}
\left. \ket{\Psi}_{out} \right|_m &= \frac{\hat{A}_m\ket{\Psi}_{in}}{||\hat{A}_m\ket{\Psi}_{in}|| }. 
\end{align}
Ignoring normalization for the moment, expanding $ \ket{\Psi}_{in} = \sum_M C_{M} \ket{J,M} $ in the standard basis
\begin{align}
\ket{\Psi}_{out} &\propto \sum_M e^{-\frac{(m-M)^2}{4\sigma^2}} C_{M} \ket{J,M}.
\end{align}
Therefore, the probability of the output state being conditioned on the measurement $ m $ is 
\begin{align}
P_{M|m} &\propto  e^{-\frac{(m-M)^2}{2\sigma^2}} |C_{M}|^2 = e^{-\frac{(m-M)^2}{2\sigma^2}} P_{M|in}.
\end{align}
If the input state is a SCS with $ J\gg 1 $, the initial $ P_{M|in} $ is well approximated as Gaussian, $ P_{M|in}=e^{-\frac{M^2}{2\Delta J_{in}^2}} $ with $ \Delta J_{in}^2=J/2 $. Thus,
\begin{align}
P_{M|m} \propto e^{-\frac{(M-\bar{M}(m))^2}{2\Delta J_{out}^2}},
\end{align}
where $ \Delta J_{out}^2 =\frac{\Delta J_{in}^2}{1+\xi} $, $ \bar{M}(m)=\frac{m}{1+\xi} $, and $ \xi\equiv \frac{\Delta J_{in}^2}{\sigma^2}=\frac{J}{2\sigma^2} $ is the measurement strength which characterizes the measurement backaction and the squeezing effect. The ability to resolve the initial quantum variance of $ J_z $ within the resolution of the meter is the key to QND squeezing. 

\textcolor{red}{Need a plot of probability distribution change after squeezing.}

Now, we go back to the effective Hamiltonian of the spin-photon system described in Equ.~\ref{HeffLS}, and rewrite it in terms of the Stokes and spin operators that 
\begin{align}
\op{\uparrow}{\uparrow} &= \hat{j}_z + \hat{j}_0 \\ \op{\downarrow}{\downarrow} &= \hat{j}_0 - \hat{j}_z\\
\hat{a}_H\dg \hat{a}_H &= \hat{S}_0 + \hat{S}_1\\
\hat{a}_V\dg \hat{a}_V &= \hat{S}_0 - \hat{S}_1
\end{align}
and sum over all spins. We can obtain
\begin{align}
H_{\rm eff} = \hbar \Big\{ & \big( \chi_{H,\uparrow} + \chi_{H,\downarrow} + \chi_{V,\uparrow} + \chi_{V,\downarrow}\big) \hat{J}_0 \hat{S}_0 \nonumber \\
+ & \big( \chi_{H, \uparrow} + \chi_{H,\downarrow} - \chi_{V,\uparrow} - \chi_{V,\downarrow} \big)  \hat{J}_0 \hat{S}_1 \nonumber \\
+ & \big( \chi_{H,\uparrow} - \chi_{H,\downarrow} + \chi_{V,\uparrow} - \chi_{V,\downarrow} \big)  \hat{J}_z \hat{S}_0 \nonumber \\
+ & \big( \chi_{H,\uparrow} - \chi_{H,\downarrow} - \chi_{V,\uparrow} + \chi_{V,\downarrow} \big)  \hat{J}_z \hat{S}_1\Big\}\\
=\hbar \Big\{ & \left[ \big( \chi_{H,\uparrow} + \chi_{H,\downarrow}\big) + \big(\chi_{V,\uparrow} + \chi_{V,\downarrow}\big) \right] \hat{J}_0 \hat{S}_0 \nonumber \\
+ & \left[ \big( \chi_{H, \uparrow} + \chi_{H,\downarrow}\big) - \big( \chi_{V,\uparrow} + \chi_{V,\downarrow} \big)\right]  \hat{J}_0 \hat{S}_1 \nonumber \\
+ & \left[ \big( \chi_{H,\uparrow} - \chi_{H,\downarrow}\big) + \big(\chi_{V,\uparrow} - \chi_{V,\downarrow} \big) \right] \hat{J}_z \hat{S}_0 \nonumber \\
+ & \left[ \big( \chi_{H,\uparrow} - \chi_{H,\downarrow}\big) - \big(\chi_{V,\uparrow} - \chi_{V,\downarrow} \big) \right]  \hat{J}_z \hat{S}_1\Big\}
\end{align}
As discussed in Ivan's proposal, the first term is an overall scalar shift and thus does not contribute to the relative dynamics.  The second term is a constant birefringence and can be canceled with a compensating waveplate as long as the atom number remains constant which is usually the case when the trapping time is fairly large compared to the measurement time. Typically, if we choose to have the atoms on the bisection line of the $ x $- and $ y $-axes, we would have the coupling strengthen canceled. It will also remove the forth term in the equation above. The first two terms can be also be canceled when we have the detuning approximately equally biased for the $ f=3 $ and $ f=4 $ ground states. 
For example, we  can choose $ \Delta_3=-4.6 $ GHz and $ \Delta_4=4.6 $ GHz to the $ 6P_{1/2} $ excited state sublevels to satisfy this condition, where the hyperfine splitting of the excited state can be ignored ($ ~500 $ MHz) compared to the detuning. However, we would like to leave the choice of detuning to control the third and fourth terms as will be discussed consequently. 

The final term describes the QND Faraday interaction we wish to isolate (similar to the Faraday interaction since we choose to use the $ x $ axis as the quantization axis), but this requires dealing with the third term that describes the effect of the scalar light shift on the rotation of the pseudo-spin.  Canceling the third term amounts to enforcing the condition that
\begin{align}\label{eq:magiccondition}
	\chi_{H,\uparrow} - \chi_{H,\downarrow} = \chi_{V,\downarrow} - \chi_{V,\uparrow} ,
\end{align}
which can be satisfied if we carefully choose the detuning of the probe light. The wavelength to choose to cancel the third term is atom position related, since the condition is determined by the effective mode areas which may have different ratios for the $ H $ and $ V $ modes at different locals. We can the exact wavelength to satisfy this condition as the \emph{magic wavelength}\index{magic wavelength}. If this condition can be met, then we can achieve an interaction of the form,
\begin{align}
	H_{\rm eff} = \hbar \chi_{\rm eff} \hat{J}_z \hat{S}_1
\end{align}
where $\chi_{\rm eff} = 2(\chi_{H,\uparrow} - \chi_{H,\downarrow})$.  

Using this, we can prepare the spins in $ D $ state on the Bloch sphere and characterize the collective spin state along the $ z $ axis after the rotation along $ S_1 $ axis due to the photon-atom interaction. To achieve this, we use the $ \hat{S}_3 $ Stokes vector component measurement. As a result of the backaction of the polarization measurement, there is a squeezing to the collective spin state which results in a reduced uncertainty of measurement output. To see this, we assume the photon number is large and apply the Holstein-Primakoff approximation to set $ \hat{S}_1=\sqrt{\frac{\dot{N}_L}{2}}\hat{P}_{\bar{D}} $ and $ \hat{S}_3=\sqrt{\frac{\dot{N}_L}{2}}\hat{X}_{\bar{D}} $. Now the effective Hamiltonian can be written as
\begin{align}
H_{\rm eff} = \hbar \chi_{\rm eff} \sqrt{\frac{\dot{N}_L}{2}}\hat{J}_z \hat{P}_{\bar{D}}. 
\end{align}
The $ \hat{S}_3 $ measurement is achieved through sending the signal light to one input port of a beam splitter along as a vacuum input on the other input port and then performing a balanced Homodyne measurement of the $ X_{\bar{D}} $ quadrature. The equivalent Kraus operator conditional on this measurement is 
\begin{align}
\hat{A}_{X_{\bar{D}}} &= \bra{X_{\bar{D}}} e^{-i\chi_{\rm eff} \sqrt{\frac{\dot{N}_L}{2}}\hat{J}_z \hat{P}_{\bar{D}}} \ket{0}\propto \exp\left\{ -\frac{\kappa }{4}(m-\hat{J}_z)^2 \right\},
\end{align} 
where $ m=\frac{X_{\bar{D}}}{\chi_{\rm eff} \sqrt{\dot{N}_L/2}} $ is the measurement outcome in angular momentum units, and $ \kappa =\chi_{\rm eff}^2\dot{N}_L $ is the integrated measurement strength per spin. The shot noise resolution of the QND measurement is $ \sigma^2=\frac{1}{\kappa } $. The Kraus operator is exactly the same as Equ.~\eqref{KrausOpSq} to generate a spin squeezing
 state. For a SCS input state, the output state probability distribution is given by 
 %(from Ben's dissertation)
%\begin{align}
%P(\hat{X}_L=x) = \exp\left[\frac{-(x\tau)^2}{2(\frac{\tau}{2}+\chi_{\rm eff}\Delta J_z^2)} \right].
%\end{align}
%The measurement probabilities have been expressed in terms of $ x\tau $, since the measurements involve integrating the output quadrature over the duration $ \tau $. The variance of measurement outcomes increases through the addition of atomic projection noise. 
\begin{align}
P_{M|m} \propto e^{-\frac{(M-\bar{M}(m))^2}{2\Delta J_{out}^2}},
\end{align}
where $ \Delta J_{out}^2 =\frac{\Delta J_{in}^2}{1+\xi}=\frac{J}{2(1+\xi)} $, $ \bar{M}(m)=\frac{m}{1+\xi} $, and $ \xi\equiv \frac{\Delta J_{in}^2}{\sigma^2}=\frac{J}{2\sigma^2}=\frac{\chi_{e\!f\!f}^2}{4}N_A\dot{N}_L $ is the measurement strength which characterizes the measurement backaction and the squeezing effect. The ability to resolve the initial quantum variance of $ J_z $ within the resolution of the meter is the key to QND squeezing. 


\subsection{Optical pumping and spin squeezing with continuous measurement}
\subsubsection{Quantum theory of optical pumping for atom number estimation}
The joint dynamics of one atom interacting with the guided field can be expressed using a master equation formalism in the interaction picture~\cite{Gardiner2004},
\begin{align}
	\frac{d}{dt} \hat{\rho} = - \frac{i}{\hbar} \big[ \hat{H}_{\rm eff} \hat{\rho} - \hat{\rho} \hat{H}_{\rm eff}^\dagger \big] +  \sum_{F_b,F_a,q} \hat{W}_q^{F_bF_a} \hat{\rho} \hat{W}_q^{F_bF_a \dagger}.
\end{align}
%\begin{align}
%	\frac{d}{dt} \hat{\rho} = - \frac{i}{\hbar} \big[ \hat{H}_{\rm eff} \hat{\rho} - \hat{\rho} \hat{H}_{\rm eff}^\dagger \big] +  \sum_{F,q} \hat{W}_q^{F} \hat{\rho} \hat{W}_q^{F \dagger}.
%\end{align}
By summing over all atoms, one can obtain the joint dynamics of an ensemble of atoms and the guided field. 
In this section, we consider the case that the guided field input is generated by a coherent light source with a large photon flux. 
A dispersive interaction between the light and atoms is assumed throughout of this section. 
We also restrict to the \emph{clock-state}\index{state!clock state} subspace for the ground sublevels of the cesium atoms, which models the atoms as spin-$ \frac{1}{2} $ systems yet allowing non-unitary evolutions. 
We will show, in this case, the dynamics of the system can be reduced to the atomic system, and hence the squeezing parameter can be calculated solely based on the atomic dynamics. 
In the end, we can estimate the squeezing parameter using Gaussian approximation for the collective spin state. 
To show so, let us look into each component of the master equation above part by part to begin with.
We will just look at one atom case and the ensemble of atoms case can be developed sequentially. 

Firstly, we consider the effective Hamiltonian with a coherent light. Using the coherent light approximation (Equ.~\eqref{eqs:cohaHV}), the effective Hamiltonian with a diagonally polarized input light can be given by
\begin{align}
\!\!\!\!\!\!\hat{H}_{\rm eff} &= -\hat{\mathbf{E}}^{(-)}_L(\br')\cdot \alpha \cdot \hat{\mathbf{E}}^{(+)}_L=\frac{1}{\hbar}\sum_{F,F'} \frac{\hat{\mathbf{E}}^{(-)}_L(\br')\cdot \hat{\mathbf{D}}_{FF'}\hat{\mathbf{D}}_{F'F}^\dagger \cdot  \hat{\mathbf{E}}^{(+)}_L(\br')}{\Delta_{F,F'}+i\Gamma_{F'}/2}
\end{align}
%\begin{align}
%\!\!\!\!\!\!\hat{H}_{\rm eff} & \doteq  \hbar\frac{\dot{N}_L}{2}\! \Big( \chi_{H,\uparrow}\op{\uparrow}{\uparrow} \!+\!  
%\chi_{H,\downarrow} \op{\downarrow}{\downarrow} \Big)  \!+\!  \hbar\frac{\dot{N}_L}{2}\!  \Big( \chi_{V,\uparrow}\op{\uparrow}{\uparrow} \!+\!  \chi_{V,\downarrow} 
%\op{\downarrow}{\downarrow} \Big)\\
%&= \hbar \left[ \frac{\dot{N}_L}{2} \left( \chi_{H,\uparrow}+\chi_{V,\uparrow}\right) \op{\uparrow}{\uparrow} +  
%\frac{\dot{N}_L}{2} \left(\chi_{H,\downarrow}+\chi_{V,\downarrow}\right) \op{\downarrow}{\downarrow}\right]\\
%&= \hbar \left( \gamma_{\uparrow\uparrow}\op{\uparrow}{\uparrow}+ \gamma_{\downarrow\downarrow} \op{\downarrow}{\downarrow} \right),
%\end{align}
%where the coupling strength
%\begin{align}
%\!\!\!\!\!\!\!\chi_{H/V,\uparrow/\downarrow} & \equiv \chi_{H/V,F} \\
%	& =- \frac{2\pi \omega_0}{v_g} \!\!\sum_{F'}\! \sum_q \alpha_0\left( F\!,\!F'  \right) |\mathbf{e}_q \cdot 
%	\mathbf{u}_{H/V}^*(r^\prime\!\!_\perp,\phi')|^2 |o^{J'F'}_{JF} |^2 
%	|C^{F 0;1q}_{F' q}|^2
%\end{align}
where the positive frequency component of the electric field is given by
\begin{align}
\mathbf{E}^{(+)}_L(\mathbf{r}') &= \sqrt{\frac{2\pi\hbar\omega_0}{v_g}}e^{if\beta_0z} \left( \mathbf{u}_H(\br'\!_\perp)\hat{a}_{H}(t) + \mathbf{u}_{V}(\br'\!_\perp)\hat{a}_{V}(t) \right).
\end{align}
In our case, the input light is classical with a large photon flux, and hence we can turn the photon and electric field operators into C-numbers:
\begin{align}
\hat{a}_{H/V} &\rightarrow i\sqrt{\frac{\dot{N}_L}{2}} \\
\mathbf{E}^{(+)}_L(\mathbf{r}') &\rightarrow i\mathcal{E}_L^{(+)}(\br')\mathbf{e}_L  
\end{align}
with the polarization vector and field amplitude 
\begin{align}
\mathbf{e}_L &= [\mathbf{u}_H(\br'\!\!_\perp)+\mathbf{u}_V(\br'\!\!_\perp)]/\sqrt{|\mathbf{u}_H(\br'\!\!_\perp)|^2+|\mathbf{u}_V(\br'\!\!_\perp)|^2} \\
\mathcal{E}_L^{(+)} (\br') &= \sqrt{\frac{{\pi}\hbar\omega_0}{v_g}\dot{N}_L \left[ |u_{r\!_\perp}(\br'\!_\perp)|^2 + |u_\phi(\br'\!_\perp)|^2 +|u_z(\br'\!_\perp)|^2 \right]}.
\end{align}
Notice that the time-dependent phase factors are ignored in the interaction picture. 
The dipole momentum generation operator is defined as
\begin{align}
\hat{\mathbf{D}}_{F'F}^{\dagger} &= \bra{J'}| d |\ket{J}\sum_{q}\sum_{m,m'} o^{J'F'}_{JF} C^{F m;1q}_{F' m'} \mathbf{e}_q^* \op{F',m'}{F,m}.
\end{align}
Therefore, we can rewrite the interaction Hamiltonian as
\begin{align}
\!\!\!\!\!\!\hat{H}_{\rm eff} &= \sum_{F,F'} \! \frac{ |\bra{J'}| d |\ket{J} \mathcal{E}^{(+)}(\br')|^2}{\hbar(\Delta_{F,F'}+i\Gamma_{F'}/2)}\! \sum_{q,m,m'}\!\! |o^{J'F'}_{JF}\! C^{F m;1q}_{F' m'} |^2 |\mathbf{e}_q\!\cdot\! \mathbf{e}_L^*|^2\op{F,m}{F,m} \\
&= \!-\! \sum_{F,F'} \! \alpha_0(F,F')|\mathcal{E}^{(+)}(\br')|^2\!\! \sum_{q,m,m'}\!\! |o^{J'F'}_{JF}\! C^{F m;1q}_{F' m'} |^2 |\mathbf{e}_q\!\cdot\! \mathbf{e}_L^*|^2\op{F,m}{F,m}
\end{align}
with the characteristic polarizability $ \alpha_0(F,F')=- \frac{ |\bra{J'}| d |\ket{J}|^2 }{\hbar (\Delta_{F,F'}+i\frac{\Gamma_{F'}}{2})} $ given in Equ.~\eqref{eq:CharacteristicPolarizability}. From now on, we set $ \Gamma=\Gamma_{F'} $ being constant for simplicity. 

Because $\alpha_0(F,F')$ is a complex number in general, one can decompose the effective Hamiltonian into a real part that drives coherent dynamics and an imaginary part describing loss:
\begin{align}
	\hat{H}_{\rm eff} = \hat{H}_{\rm coh} + \hat{H}_{\rm loss}.
\end{align}

In our case, we are only interested in the \emph{clock-state} subspace of the atoms, which fixes $ m=0 $ for the ground states and $ m'=q $ for the excited states to have non-zero contributions from the corresponding quantum transitions. We also want to restrict our attention to the magic frequency case, in which the coherent transition rates for the two ground sublevels, $ \ket{\uparrow}=\ket{F=4,m_F=0} $ and $ \ket{\downarrow}=\ket{F=3,m_F=0} $, are equal and do not contribute to the dynamics of the system ($ [\hat{H}_{\rm coh}\hat{\rho}-\hat{\rho}\hat{H}_{\rm coh}]=0 $ using $ y $ axis as the quantization axis). The loss part of the effective Hamiltonian at a magic frequency can be given by
\begin{align}
\hat{H}_{\rm loss} &= -i\hbar  \left(  \frac{\gamma_{\uparrow}}{2} \op{\uparrow}{\uparrow} + \frac{\gamma_{\downarrow}}{2} \op{\downarrow}{\downarrow} \right)\\
&=  -\frac{i\hbar}{2}  \left[ \frac{ \gamma_{\uparrow}}{2} \left(\hat{I}+\hat{\sigma}_z \right) + \frac{ \gamma_{\downarrow}}{2} \left(\hat{I}-\hat{\sigma}_z \right) \right]\\
&= -\frac{i\hbar}{2} \left(  \frac{\gamma_{\uparrow}+\gamma_{\downarrow}}{2} \hat{I} + \frac{\gamma_{\uparrow}-\gamma_{\downarrow}}{2} \hat{\sigma}_z  \right)\\
&= -\frac{i\hbar}{2}\left(\gamma_s^+\hat{I} + \gamma_s^-\hat{\sigma}_z \right)
\end{align}
where 
\begin{align}
 \gamma_s^+ &= \frac{\gamma_{\uparrow}+\gamma_{\downarrow} }{2}\\
\gamma_s^- &= \frac{\gamma_{\uparrow}-\gamma_{\downarrow} }{2}\\
\!\!\!\!\!\!\!\! \gamma_{\uparrow} &=  \sum_{F'} \! \frac{|\bra{J'}|d|\ket{J}|^2\Gamma}{\hbar^2(\Delta_{4,F'}^2+\Gamma^2/4)}|\mathcal{E}^{(+)}(\br')|^2\!\! \sum_{q}\! |o^{J'F'}_{J4}\! C^{4 0;1q}_{F' q} |^2 |\mathbf{e}_q\!\cdot\! \mathbf{e}_L^*|^2\\
&=  \sum_{F'} \! \frac{\Gamma\Omega^2/4}{\Delta_{4,F'}^2+\Gamma^2/4}\!\! \sum_{q}\! |o^{J'F'}_{J4}\! C^{4 0;1q}_{F' q} |^2 |\mathbf{e}_q\!\cdot\! \mathbf{e}_L^*|^2\\
&= \dot{N}_L \frac{\pi \omega_0}{\hbar v_g} \!\!\sum_{F'\! , q}\! \frac{\Gamma |\bra{J'}|d|\ket{J}|^2}{\Delta_{4,F'}^2+\Gamma^2/4} |o^{J'F'}_{J4}\! C^{4 0;1q}_{F' q}|^2  %\nonumber\\
%&\quad\quad\quad\quad\quad\quad\quad\quad\quad   
|\mathbf{e}_q \!\cdot\! 
\left( \mathbf{u}_{H}^*(\br^\prime\!\!_\perp) \!+\! 
\mathbf{u}_{V}^*(\br^\prime\!\!_\perp)\right) |^2\\
\gamma_{\downarrow} &= \sum_{F'} \! \frac{|\bra{J'}|d|\ket{J}|^2\Gamma}{\hbar^2(\Delta_{3,F'}^2+\Gamma^2/4)}|\mathcal{E}^{(+)}(\br')|^2\!\! \sum_{q}\! |o^{J'F'}_{J3}\! C^{3 0;1q}_{F' q} |^2 |\mathbf{e}_q\!\cdot\! \mathbf{e}_L^*|^2\\
&=  \sum_{F'} \! \frac{\Gamma\Omega^2/4}{\Delta_{3,F'}^2+\Gamma^2/4}\!\! \sum_{q}\! |o^{J'F'}_{J3}\! C^{3 0;1q}_{F' q} |^2 |\mathbf{e}_q\!\cdot\! \mathbf{e}_L^*|^2\\
&= \dot{N}_L\frac{\pi \omega_0}{\hbar v_g} \!\!\sum_{F'\! , q}\! \frac{\Gamma |\bra{J'}|d|\ket{J}|^2}{\Delta_{3,F'}^2+\Gamma^2/4} |o^{J'F'}_{J3}\! C^{3 0;1q}_{F' q}|^2  %\nonumber\\
%&\quad\quad\quad\quad\quad\quad\quad\quad\quad   
|\mathbf{e}_q \!\cdot\! 
\left( \mathbf{u}_{H}^*(\br^\prime\!\!_\perp) \!+\! 
\mathbf{u}_{V}^*(\br^\prime\!\!_\perp)\right) |^2.
\end{align}
We have defined the local Rabi frequency\index{Rabi frequency} as
\begin{align}
\Omega(\mathbf{r}') &= \frac{2\bra{J'}| d | \ket{J} \mathcal{E}^{(+)}_L(\mathbf{r}')}{\hbar}.
\end{align}
Note that, in general, the loss Hamiltonian, $ \hat{H}_{\rm loss}=\sum_q \hat{L}_q^\dagger\hat{L}_q $, may have off-diagonal elements in the truncated clock-state subspace. But we have ignored them due to the preferred selection of transitions using the magic frequency technique. 


Next, let us look into the jump operators.
For atoms placed along $ \phi'=0 $ or $ \pi $ two-side chains, the jump operators for optical pumps between magnetic sublevels are \cite{Deutsch2010a}
\begin{align} \label{Eq::JumpOperators}
\hat{W}_q^{F_bF_a} &= \sum_{F'} \sqrt{\Gamma}\frac{\Omega(\mathbf{r}')/2}{ \Delta_{F'F_a} + i\Gamma/2} \mathbf{e^*_q} \cdot \hat{\boldsymbol{\sigma}}_{F_bF'} \hat{\boldsymbol{\sigma}}_{F'F_a}^{\dagger} \cdot \mathbf{e}_L \\
&= \sum_{F'} \sqrt{\Gamma}\frac{\Omega(\mathbf{r}')/2}{ \Delta_{F'F_a} + i\Gamma/2} o^{J'F'}_{JF_b} o^{J'F'}_{JF_a}\nonumber\\
& \sum_{m_b=0,m_a=0,m'=q}\!\!\!\!\!\!\!\!\!\! C^{F_b m_b;1q}_{F' m'} \sum_{q'=q}C^{F_a m_a;1q'}_{F' m'} \left(\mathbf{e}^*_{q'} \cdot\mathbf{e}_L \right) \op{F_b,m_b}{F_a,m_a}\\
&= \sum_{F'} \!\!\frac{\sqrt{\Gamma}\Omega(\mathbf{r}')/2}{ \Delta_{F'F_a} \!\!+\! i\Gamma/2} o^{J'F'}_{JF_b}\! o^{J'F'}_{JF_a}\!  C^{F_b 0;1q}_{F' q}\! C^{F_a 0;1q}_{F' q}\! \left(\mathbf{e}^*_{q}\! \cdot\! \mathbf{e}_L \right)\! \op{F_b,0}{F_a,0}
\end{align}
with $ \hat{\boldsymbol{\sigma}}_{F'F}^{\dagger}=\hat{\mathbf{D}}_{F'F}^{\dagger}/\bra{J'}| d |\ket{J} $.
%\begin{align} \label{Eq::JumpOperators}
%\hat{W}_q^F &= \sum_{F'} \sqrt{\Gamma}\frac{\Omega(\mathbf{r}')/2}{ \Delta_{F'F} + i\Gamma/2} \mathbf{e^*_q} \cdot \hat{\mathbf{D}}_{FF'} \hat{\mathbf{D}}_{F'F}^{\dagger} \cdot \mathbf{e}_L \\
%&= \sum_{F'} \sqrt{\Gamma}\frac{\Omega(\mathbf{r}')/2}{ \Delta_{F'F} + i\Gamma/2} o^{J'F'}_{JF} o^{J'F'}_{JF}\nonumber\\
%& \quad \sum_{m=0,m'=q}\!\!\!\!\!\!\!\!\! C^{F m;1q}_{F' m'} \sum_{q'=q}C^{F m;1q'}_{F' m'} \left(\mathbf{e}^*_{q'} \cdot\mathbf{e}_L \right) \op{F,m}{F,m}\\
%&= \sum_{F'} \!\!\frac{\sqrt{\Gamma}\Omega(\mathbf{r}')/2}{ \Delta_{F'F} \!\!+\! i\Gamma/2} \! \left|o^{J'F'}_{JF}\right|^2\!  \left| C^{F 0;1q}_{F' q}\right|^2\! \left(\mathbf{e}^*_{q}\! \cdot\! \mathbf{e}_L \right)\! \op{F,0}{F,0}
%\end{align}

%We have also defined the decay rates 
%\begin{align}
%\gamma_{\uparrow\uparrow} &= \frac{\dot{N}_L}{2} \left( \chi_{H,\uparrow}+\chi_{V,\uparrow}\right) \\
%\gamma_{\downarrow\downarrow} &= \frac{\dot{N}_L}{2} \left(\chi_{H,\downarrow}+\chi_{V,\downarrow}\right).
%\end{align}


Therefore, the optical transition rates from $ \ket{F_a,m_F=0} $ to $ \ket{F_b,m_F=0} $ in the truncated clock-state subspace can be given by
\begin{align}
\gamma_{F_bF_a} &=\gamma_{F_a\rightarrow F_b} = \sum_{F_{a'},F_{b'},q} \left| \bra{F_b,0} \hat{W}_q^{F_{b'}F_{a'}}\ket{F_a,0}\right|^2\\
&= \frac{\Omega^2(\mathbf{r}')}{4}\sum_{F',q} \Gamma\left|  \frac{o^{J'F'}_{JF_b}\! o^{J'F'}_{JF_a}\!  C^{F_b 0;1q}_{F' q}\! C^{F_a 0;1q}_{F' q}\! \left(\mathbf{e}^*_{q}\! \cdot\! \mathbf{e}_L \right)}{ \Delta_{F'F_a} \!\!+\! i\Gamma/2} \right|^2\\
&= \frac{\Gamma\Omega^2(\mathbf{r}')}{4}\sum_{F',q}   \frac{ \left|o^{J'F'}_{JF_b}\! o^{J'F'}_{JF_a}\!  C^{F_b 0;1q}_{F' q}\! C^{F_a 0;1q}_{F' q}\! \left(\mathbf{e}^*_{q}\! \cdot\! \mathbf{e}_L \right)\right|^2}{ \Delta_{F'F_a}^2 \!\!+\! \Gamma^2/4} .
\end{align} 
%Therefore, the optical pumping rates for $ \ket{F,m_F=0} $ by a $ q $-transition can be given by
%\begin{align}
%\gamma_{F,q} &=\gamma_{F\rightarrow F}^q = \sum_{F_{a'}} \left| \bra{F} \hat{W}_q^{F_{a'}}\ket{F}\right|^2\\
%&= \frac{\Gamma\Omega^2(\mathbf{r}')}{4}\sum_{F'} \left|  \frac{\left| o^{J'F'}_{JF}\right|^2\!   \left| C^{F 0;1q}_{F' q}\right|^2\! \left(\mathbf{e}^*_{q}\! \cdot\! \mathbf{e}_L \right)}{ \Delta_{F'F} \!\!+\! i\Gamma/2} \right|^2\\
%&= \dot{N}_L\frac{\pi \omega_0}{\hbar v_g} \!\!\sum_{F'\! , q}\! \frac{\Gamma |\bra{J'}|d|\ket{J}|^2}{\Delta_{F,F'}^2+\Gamma^2/4} |o^{J'F'}_{JF} |^4 |C^{F 0;1q}_{F' q}|^4  \nonumber\\
%&\quad\quad\quad\quad\quad\quad\quad\quad\quad  \left[ |\mathbf{e}_q^* \!\cdot\! \left(
%\mathbf{u}_{H}(\br^\prime\!\!_\perp) +  
%\mathbf{u}_{V}(\br^\prime\!\!_\perp)\right)|^2\right].
%\end{align}
%Notice that, the cross-feeding transitions between ground state sublevels are not considered in this model.

Now we generalize one-atom system to an $ N_A $-atom system by replacing $\hat{W}_q^{F_bF_a}\rightarrow \hat{W}_q^{F_bF_a}(\br_i)  $ and sum over all the other local atomic operators for the ensemble.
%We also narrow our interest to the interaction using a magic frequency case which has an effective Hamiltonian proportional to a unitary operator. 
The master equation for the collective spin system can be written as 
\begin{align}
\dt{\hat{\rho}} &= -\frac{i}{\hbar}\left[\hat{H}_{\rm loss}\hat{\rho} -\hat{\rho}\hat{H}_{\rm loss}^\dagger\right] + \sum_{F_b,F_a,q,i}\! \hat{W}_q^{F_bF_a}(\br_i) \hat{\rho} \hat{W}_q^{F_bF_a \dagger}(\br_i) \\
&= \mathcal{D} \left[ \hat{\rho}\right]=\sum_i \mathcal{D}^{(i)} \left[\hat{\rho}^{(i)} \right].
\end{align}
we have ignored the interactions between different atoms. 
Therefore, the density operator for the $ i $-th atom obeys the independent master equation given by
\begin{align}
\dt{\hat{\rho}^{(i)}} &= \mathcal{D}^{(i)} \left[\hat{\rho}^{(i)} \right] \label{eq:drhoidtDi}\\
&= -\frac{i}{\hbar}\left[\hat{H}_{\rm loss}^{(i)} \hat{\rho}^{(i)} -\hat{\rho}^{(i)}\hat{H}_{\rm loss}^{(i)\dagger}\right] + \sum_{F_b,F_a,q}\! \hat{W}_q^{F_bF_a}(\br_i) \hat{\rho} \hat{W}_q^{F_bF_a \dagger}(\br_i).
\end{align}

Hence the master equation describing the expectation values of an arbitrary Hermitian and one-body operator $ \hat{O}^{(i)} $ evolves as
\begin{align}
\!\!\!\!\!\!\!\!\!\! \dt{\expect{\hat{O}^{(i)} }} &= \dt{}\tr\left[\hat{\rho}^{(i)}\hat{O}^{(i)} \right]=\tr\left[\dt{\hat{\rho}^{(i)}}\hat{O}^{(i)} \right]=\tr\left[\mathcal{D}^{(i)}(\hat{\rho}^{(i)})\hat{O}^{(i)} \right]\\
&= \tr\left[\! -\frac{i}{\hbar}\left(\hat{O}^{(i)}\hat{H}_{\rm loss}^{(i)}\!-\! \hat{H}_{\rm loss}^{(i)\dagger}\hat{O}^{(i)}  \right)\!\hat{\rho}^{(i)} \!+\! \!\sum_{F_a,F_b,q} \!\! \!\hat{W}_q^{F_bF_a\dagger}(\br_i) \hat{O}^{(i)} \hat{W}_q^{F_bF_a}(\br_i)\hat{\rho}^{(i)} \right]\\
&=-\frac{i}{\hbar}\expect{\left[\hat{O}^{(i)}\hat{H}_{\rm loss}^{(i)} \!-\! \hat{H}_{\rm loss}^{(i)\dagger}\hat{O}^{(i)}\right]}+ \expect{\!\!\sum_{F_b,F_a,q}\!\! \hat{W}_q^{F_bF_a\dagger}(\br_i) \hat{O}^{(i)} \hat{W}_q^{F_bF_a}(\br_i) }\\
&= \expect{\mathcal{D}^{(i)\dagger}\left[\hat{O}^{(i)} \right] }
%&= -\gamma_s^+\expect{\hat{O}} \!-\! \frac{\gamma_s^-}{2}\sum_i^{N_A}\expect{\!\left\{ \hat{\sigma}_z^{(i)},\hat{O} \right\}\!} \!+\! \expect{\!\!\sum_{F_b,F_a,i}\!\! \gamma_{F_bF_a} \op{F_b,0}{F_a,0}^{(i)} \hat{O} \op{F_a,0}{F_b,0}^{(i)} },
\end{align}
%In fact, to ensure $ \hat{\rho}^{(i)} $ Hermitian, Equ.~\eqref{eq:drhoidtDi} implies that $ \mathcal{D}^{(i)\dagger}=\mathcal{D}^{(i)} $. 

Similarly, for a joint density operator between different atoms $ i $ and $ j $, the master equation gives
\begin{align}
\dt{\hat{\rho}^{(i,j)}} &= \mathcal{D}^{(i)}\left[\hat{\rho}^{(i,j)} \right] + \mathcal{D}^{(j)}\left[ \hat{\rho}^{(i,j)}\right]. 
\end{align}
Then, the expectation value of a two-body operator $ \hat{A}^{(i)}\hat{B}^{(j)} \,(i\neq j)$ evolves as 
\begin{align}
\left.\dt{\expect{\hat{A}^{(i)}\hat{B}^{(j)} } }\right|_{i\neq j} &= \tr \left[ \dt{\hat{\rho}^{(i,j)}} \hat{A}^{(i)}\hat{B}^{(j)}  \right]\\
&= \expect{\mathcal{D}^{(i)\dagger}\left[\hat{A}^{(i)} \right]\hat{B}^{(j)} } + \expect{\hat{A}^{(i)}\mathcal{D}^{(j)\dagger}\left[\hat{B}^{(j)} \right] }.
\end{align}



\subsubsection{The microscopic perspective analysis of continuous measurement and spin squeezing}

The measurement operator after the probe light interacting with the ensemble of atoms can be given by
\begin{align}
\hat{\mathcal{M}} &= \sum_i^{N_A} \int_0^T \mathrm{d}t' \hat{X}_{\bar{D}}^{\rm out} (z_D,t'-(z_{D}-z_i')/v_p),\label{eq:Mxout}
\end{align}
where $ T $ and $ Z_D $ are the integration time and position of the detector, $ z_i' $ is the $ z $-coordinate of the $ i $-th atom. 
 

For each atom, using the effective Hamiltonian that causes the birefringence effect, 
\begin{align}
\hat{H}_{\rm eff} &= \hbar \chi_{\rm eff} \sqrt{\frac{\dot{N}_L}{2}} \hat{F}_z \hat{P}_{\bar{D}}
\end{align}
one can find the equation of motion for the quadrature operator $ \hat{X}_{\bar{D}} $ to be
\begin{align}
\dt{\hat{X}_{\bar{D}}(z,t)} &= -\frac{i}{\hbar} \left[ \hat{H}_{\rm eff},\hat{X}_{\bar{D}} \right] \\
\Leftrightarrow \pp{\hat{X}_{\bar{D}}(z,t)}{t}+v_g\pp{\hat{X}_{\bar{D}}(z,t)}{z} &=  \chi_{\rm eff} \sqrt{\frac{\dot{N}_L}{2}} \hat{F}_z.
\end{align}
A formal solution can be given by
\begin{align}
\hat{X}_{\bar{D}} (z,t) &= \hat{X}_{\bar{D}}(0,t-z/v_p) + \sqrt{\frac{\kappa}{2}}\hat{F}_z(t-(z-z'_i)/v_p)\Theta(z-z'_i),
\end{align} 
where the measurement strength per atom is defined as $ \kappa = \chi_{\rm eff}^2 \dot{N}_L $. 

Using the result above, Equ.~\ref{eq:Mxout} gives
\begin{align}
\hat{\mathcal{M}}(T) &= N_A\int_0^T\mathrm{d}t \hat{X}_{\bar{D}}(0,t-z_D/v_p) + N_A \sqrt{\frac{\kappa}{2}}\int_0^T\mathrm{d}t\hat{F}_z(t)\\
&\approx N_A\int_0^T\mathrm{d}t \hat{X}_{\bar{D}}(0,t-z_D/v_p) + N_AT\sqrt{\frac{\kappa}{2}}\hat{F}_z.
\end{align}
In the last step, we have used the fact that all atoms around a nanofiber are interacting with the probe light in the same manner, and we have assumed the transition time of the light passing through the ensemble of atoms is much shorter than the atomic dynamics and the sampling time of the detector. 

Since the setup of the photon detectors imply a vacuum state of the photonic operators. The mean value of the measurement can be given by 
\begin{align}
\expect{\hat{\mathcal{M}}}(T) &\approx N_AT\sqrt{\frac{\kappa}{2}}\expect{\hat{F}_z(0)}.
\end{align}

The variance of the measurement can be described by
\begin{align}
\Delta \mathcal{M}^2(T) &= \expect{\hat{\mathcal{M}}^2}-\expect{\hat{\mathcal{M}}}^2\\
&= N_A^2 \int_0^T\mathrm{d}t \int_0^T\mathrm{d}t'  \expect{\Delta\hat{X}_{\bar{D}}(0,t-z_D/v_p)\Delta\hat{X}_{\bar{D}}(0,t'-z_D/v_p)} \nonumber\\
&\quad + N_A^2 \frac{\kappa}{2} \int_0^T\mathrm{d}t \int_0^T\mathrm{d}t'\expect{\Delta\hat{F}_z(t)\Delta\hat{F}_z(t')}\\
&\approx \frac{N_A^2T}{2} + \frac{\kappa N_A^2T^2}{2} \Delta\hat{F}_z^2\\
&\equiv \Delta \mathcal{M}_{\rm SN}^2 + \Delta\mathcal{M}_{\rm PN}^2.
\end{align}
To derive the result above, we have used the fact that the covariance $ \expect{\Delta\hat{X}_{\bar{D}}(0,t-z_D/v_p)\Delta\hat{X}_{\bar{D}}(0,t'-z_D/v_p)}\equiv \expect{\hat{X}_{\bar{D}}(0,t-z_D/v_p)\hat{X}_{\bar{D}}(0,t'-z_D/v_p)}-\expect{\hat{X}_{\bar{D}}(0,t-z_D/v_p)}\expect{\hat{X}_{\bar{D}}(0,t'-z_D/v_p)}=\delta(t-t')/2 $ for the vacuum fluctuations, which leads to the vacuum shot noise $ \Delta \mathcal{M}_{\rm SN}^2=\frac{N_A^2T}{2} $. The additional projection noise, $ \Delta\mathcal{M}_{\rm PN}^2=\frac{\kappa N_A^2T^2}{2} \Delta\hat{F}_z^2(0) $, is the signal comes from the variance of the $ z $-projection of the collective spin state.  

...

Using the results above, one can write the stochastic master equation for the continuous measurement with the probe light discussed in this section...


\subsection{Sensitivity of the birefringence measurement using the clock states}
\textcolor{red}{To answer the question in this section: How to relate this to the critical shot noise limit--Equ.~\eqref{eq:shotnoise}?}  

For the birefringence measurement of the clock states discussed above, the fluctuation of the $ S_3 $ measurement is a combination effect of the shot noise fluctuation of the photon detector and the projection noise as the signal to determine the collective spin state:
\begin{align}
\Delta M^2 &= \Delta\mathcal{M}_{\rm SN}^2 + \Delta\mathcal{M}_{\rm PN}^2\\
&\equiv \Delta P^2_{SN} + \Delta P^2_S .
\end{align}
As have been discussed in Section~\ref{sec:birefringenceresolution}, the smallest detectable spin polarization is determined by the shot noise limit condition that 
\begin{align}
\Delta P_S = \Delta P_{SN},
\end{align}
where the standard variance of the signal can be estimated by
\begin{align}
\Delta P_S=P_0 \sin(\varphi_{_N}) \approx P_0 \varphi_{_N}
\end{align}
and the shot noise variance is determined by
\begin{align}
\Delta P_{SN} = \sqrt{\frac{P_0 \hbar \omega_0 }{2\eta \tau_{pd}}}.
\end{align}
We estimate the phase difference as
\begin{align}
\varphi_{_N} &= N_A \chi_{e\!f\!f}=N_A [(\chi_{H,\uparrow}-\chi_{H,\downarrow})-(\chi_{V,\uparrow}-\chi_{V,\downarrow})]\\
&= 2N_AC_{j'}^{(0)}(\Gamma_{H}^{1D}-\Gamma_V^{1D})\frac{1}{\Delta}=\frac{C_{j'}^{(0)}\sigma_0\Gamma_{vac}}{2}(\frac{1}{A^H_{e\!f\!f}}-\frac{1}{A^V_{e\!f\!f}})\frac{1}{\Delta}\\
&=N_AC_{j'}^{(0)}n_g\sigma_0\frac{\Gamma_{vac}}{2\Delta}\left[| \mathbf{u}_H(r'_{\!\perp})|^2- | \mathbf{u}_V(r'_{\!\perp})|^2 \right],
\end{align}
where $\frac{1}{\Delta}=\frac{1}{2}\sum_{f'}(\frac{1}{\Delta_{f',4}}-\frac{1}{\Delta_{f',3}})\approx \frac{1}{\Delta_{f',4}}$.

Now, we consider the critical case: $\eta =100\%$ and $\tau_{pd} = \frac{1}{\gamma_s}$, where the photon scattering rate
\begin{align*}
\gamma_s &= \sigma(\Delta) \frac{I(\br')}{\hbar \omega_0} \\
\sigma(\Delta) &=\frac{\sigma_0}{1+\frac{4\Delta^2}{\Gamma^2_{vac}}}\approx \sigma_0 \frac{\Gamma_{vac}^2}{4\Delta^2} \quad \text{(far detuning.)}
\end{align*}
We can rewrite 
\begin{align}
\Delta P_{SN} &=P_0\sqrt{\frac{ \sigma_0 }{2A_{in}}}\frac{\Gamma_{vac}}{2\Delta},\\
\Delta P_S &= N_A C_{j'}^{(0)}P_0 \frac{\sigma_0}{A_{e\!f\!f}}\frac{\Gamma_{vac}}{2\Delta}, 
\end{align}
with the effective mode areas
\begin{align}
A_{in } &= \frac{P_0}{I(\br')}=\frac{2}{| \mathbf{u}_H(r'_{\!\perp})|^2+ | \mathbf{u}_V(r'_{\!\perp})|^2},\\
A_{e\!f\!f} &= \frac{1}{n_g\left[ | \mathbf{u}_H(r'_{\!\perp})|^2- | \mathbf{u}_V(r'_{\!\perp})|^2\right]}.
\end{align}
Therefore, the $ \Delta P_S = \Delta P_{SN}$ condition gives the resolution of the birefringence measurement in terms of the minimum atom number as
\begin{align}
N^{min}_A &= \frac{1}{C_{j'}^{(0)}}\sqrt{\frac{A_{e\!f\!f}^2}{A_{in}\sigma_0}}.
\end{align}

%</quantumdynamics>

\appendix

%<*basistransfHS>

\chapter{Spin-polarization coupling Hamiltonian and Stokes vectors under coordinate transformation}\label{chap:basistransfHS}
In this appendix, we will derive the equations of Stokes vector operators and spin-polarization interaction Hamiltonian due to polarization basis transformations.
A general basis transformation theory will be derived in the context of linear-polarization basis transformations, and will then be applied to the linear $ D/\bar{D} $- and circular $ R/L $-bases cases.

\section{Spin-polarization Hamiltonian and Stokes vector operators in a linear basis}\label{sec:spinpolarizationinlinearbasis}
In general, we can define an arbitrary linear polarization basis by
\begin{align}\label{eq:nnbarRHV}
\left(\!\begin{array}{c}
\mathbf{e}_n \\ \mathbf{e}_{\bar{n}}
\end{array}\!\right) &= 
\left(\!\!\begin{array}{cc}
\cos\theta & \sin\theta \\
- \sin\theta & \cos\theta
\end{array}\!\!\right)\bullet
\left(\!\begin{array}{c}
\mathbf{e}_H \\ \mathbf{e}_V
\end{array}\!\right)
=\mathbf{R}(\theta)\bullet \left(\!\begin{array}{c}
\mathbf{e}_H \\ \mathbf{e}_V
\end{array}\!\right),
\end{align}
or the inversed relationship
\begin{align}
\left(\!\begin{array}{c}\mathbf{e}_H \\ \mathbf{e}_V\end{array}\!\right)&= \mathbf{R}^{-1}(\theta)\bullet\left(\!\begin{array}{c}\mathbf{e}_n \\ \mathbf{e}_{\bar{n}}\end{array}\!\right),
\end{align}
where $ \theta $ is the angle of the $ \mathbf{e}_n $ basis rotated from the $ H $ direction around $ z $ axis, and $ \mathbf{e}_{\bar{n}} $ is the basis vector $ 90^\circ $ from the $ \mathbf{e}_n $ direction; $ \mathbf{R}(\theta)=\mathbf{R}_z(\theta) $ is the Euler rotation matrix about the $ z $ axis by $ \theta $ in the real-number $ \mathbf{SO}(3) $ rotation group, which has the property that $ \mathbf{R}^{-1}(\theta)=\mathbf{R}^T(\theta)=\mathbf{R}(-\theta) $. 
More generally, the basis transformation matrix is an unitary matrix determined by two parameters (two degrees of freedom)--$ \theta $ and $ \phi $--corresponding to the rotating angles around one axis and an relative phase between the base components, which is in the $ \mathbf{SU}(2) $ group.
%We denote the general case with $ \mathbf{R}=\mathbf{R}(\theta,\phi) $, or in the form of two-step rotations around $ i $ axis and then around $ j $ axis by $ \mathbf{R}=\mathbf{R}_j(\theta)\mathbf{R}_i(\phi) $, always satisfying $ \mathbf{R}^{-1}=\mathbf{R}^\dagger $ for either rotations.

Not to be confused, we have also defined an operator space spanned by operator vectors, like $ \left(\!\begin{array}{cc}\mathbf{e}_n,&\mathbf{e}_{\bar{n}}\end{array}\! \right) $, which has vectors, tensors or operators as the elements.
We have also defined the bullet operator ($ \bullet $) in the operator vector space isomorphically the same as the dot ($ \cdot $) product or matrix product in the conventional vector space while the sign of $ \cdot $ can usually be ignored and we will denote complex conjugates explicitly if needed. 
$ \mathbf{R}(\theta) $ and its transformations is a tensor defined in the operator vector space as well.
When a conventional vector or tensor multiplies with an operator vector or tensor, we will use $ \cdot $ between them and the conventional vector or tensor will be formally treated as a scalar to be $ \cdot $ multiplied with the elements of the operator vector or tensor. 
Two operator vectors in a $ \bullet $ multiplication form a mutual covariant relationship in the operator space.
 
With the coordinate basis rotated passively, both the mode components and the field creation/annihilation operators should be rotated actively by $ -\theta $ to be transformation-equivalent.
Written in the matrix form in the operator space, 
\begin{align}
\left(\!\begin{array}{c}\mathbf{u}_n \\ \mathbf{u}_{\bar{n}}\end{array}\!\right) &= \mathbf{R}^{-1}(\theta)\bullet\left(\!\begin{array}{c}\mathbf{u}_H,\\ \mathbf{u}_V\end{array}\!\right) 
&\Leftrightarrow \left(\!\begin{array}{c}\mathbf{u}_H \\ \mathbf{u}_V\end{array}\!\right) &= \mathbf{R}(\theta)\bullet\left(\!\begin{array}{c}\mathbf{u}_n, \\ \mathbf{u}_{\bar{n}}\end{array}\!\right),\\
\hat{\mathbf{a}}_{n,\bar{n}}^\dagger &=\mathbf{R}(\theta)\bullet \hat{\mathbf{a}}_{H,V}^\dagger &\Leftrightarrow \hat{\mathbf{a}}_{H,V}^\dagger&=\mathbf{R}^{-1}(\theta)\bullet \hat{\mathbf{a}}_{n,\bar{n}}^\dagger ,\\
\hat{\mathbf{a}}_{n,\bar{n}} &=\mathbf{R}^*(\theta)\bullet \hat{\mathbf{a}}_{H,V}=\mathbf{R}(\theta)\bullet \hat{\mathbf{a}}_{H,V}  &\Leftrightarrow \hat{\mathbf{a}}_{H,V}&=\mathbf{R}^{-1}(\theta)\bullet \hat{\mathbf{a}}_{n,\bar{n}},
\end{align}
where $ \hat{\mathbf{a}}_{n,\bar{n}}^\dagger=[\hat{a}_n^\dagger;\hat{a}_{\bar{n}}^\dagger] $ and $ \hat{\mathbf{a}}_{H,V}^\dagger=[\hat{a}_H^\dagger;\hat{a}_V^\dagger] $ are the creation operator vectors in the $ \{n,\bar{n} \} $ and $ \{H,V \} $ bases, respectively. These creation operators create photons in corresponding polarization basis. The annihilation operator vectors, $ \hat{\mathbf{a}}_{n,\bar{n}} =[\hat{a}_n;\hat{a}_{\bar{n}}]$, can be defined correspondingly.
In our notation, we use the $ [\cdot ;\cdots] $ notation to indicate $ 1\times n $ vectors as general matrices, where the semi-comma (``;") sign separates matrix elements in different rows and the comma (``,") sign separates matrix elements in different columns.

Using the definition in the $ \{ H,V\} $-basis of the Stokes operators (Eq.\eqref{eq:SopinaHVbasis}) and the annihilation operator basis transformation relationships above, one can rewrite the Stokes operators in the $ \{\mathbf{e}_n, \mathbf{e}_{\bar{n}}\} $ basis by
\begin{subequations}\label{eq:Snnbar}
\begin{align}
\hat{S}_0 &= \frac{1}{2}\left[\left(\!\begin{array}{cc}\hat{a}_n^\dagger,& \hat{a}_{\bar{n}}^\dagger\end{array} \!\right)\bullet\mathbf{R}^{-1}_{[1,:]}{}^\dagger(\theta)\bullet\mathbf{R}^{-1}_{[1,:]}(\theta)\bullet
\left(\!\begin{array}{c}\hat{a}_n\\ \hat{a}_{\bar{n}}\end{array} \!\right)\right. \nonumber\\
&\quad\quad \left. + \left(\!\begin{array}{cc}\hat{a}_n^\dagger,& \hat{a}_{\bar{n}}^\dagger\end{array} \!\right)\bullet\mathbf{R}^{-1}_{[2,:]}{}^\dagger(\theta)\bullet\mathbf{R}^{-1}_{[2,:]}(\theta)\bullet
\left(\!\begin{array}{c}\hat{a}_n\\ \hat{a}_{\bar{n}}\end{array} \!\right) \right]\nn\\
&= \frac{1}{2}\left\{\left(\!\begin{array}{cc}\hat{a}_n^\dagger,& \hat{a}_{\bar{n}}^\dagger\end{array} \!\right)\bullet
\left[\left(\!\begin{array}{cc}\cos^2\theta,& -\frac{1}{2}\sin 2\theta \\ -\frac{1}{2}\sin 2\theta, & \sin^2\theta\end{array} \!\right)\right.\right.\nonumber\\
&\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad \left.\left.+ \left(\!\begin{array}{cc}\sin^2\theta,& \frac{1}{2}\sin 2\theta \\ \frac{1}{2}\sin 2\theta, & \cos^2\theta\end{array} \!\right)\right]\bullet
\left(\!\begin{array}{c}\hat{a}_n\\ \hat{a}_{\bar{n}}\end{array} \!\right)\right\}\nn\\
&=\frac{1}{2} \left[\hat{a}_n^\dagger\hat{a}_n+\hat{a}_{\bar{n}}^\dagger\hat{a}_{\bar{n}} \right]\\
\hat{S}_1 &= \frac{1}{2}\left\{\left(\!\begin{array}{cc}\hat{a}_n^\dagger,& \hat{a}_{\bar{n}}^\dagger\end{array} \!\right)
\bullet\left[\mathbf{R}^{-1}_{[1,:]}{}^\dagger(\theta)\bullet\mathbf{R}^{-1}_{[1,:]}(\theta) - \mathbf{R}^{-1}_{[2,:]}{}^\dagger(\theta)\bullet\mathbf{R}^{-1}_{[2,:]}(\theta) \right]
\bullet\left(\!\begin{array}{c}\hat{a}_n\\ \hat{a}_{\bar{n}}\end{array} \!\right) \right\}\nn\\
&= \frac{1}{2} \left[\cos 2\theta \hat{a}_n^\dagger\hat{a}_n - \sin 2\theta \hat{a}_n^\dagger\hat{a}_{\bar{n}} - \sin 2\theta \hat{a}_{\bar{n}}^\dagger\hat{a}_n -\cos 2\theta \hat{a}_{\bar{n}}^\dagger\hat{a}_{\bar{n}} \right]\\
\hat{S}_2 &= \frac{1}{2}\left\{\left(\!\begin{array}{cc}\hat{a}_n^\dagger,& \hat{a}_{\bar{n}}^\dagger\end{array} \!\right)
\bullet\left[\mathbf{R}^{-1}_{[1,:]}{}^\dagger(\theta)\bullet\mathbf{R}^{-1}_{[2,:]}(\theta) + \mathbf{R}^{-1}_{[2,:]}{}^\dagger(\theta)\bullet\mathbf{R}^{-1}_{[1,:]}(\theta) \right]
\bullet\left(\!\begin{array}{c}\hat{a}_n\\ \hat{a}_{\bar{n}}\end{array} \!\right) \right\}\nn\\
&= \frac{1}{2} \left[\sin 2\theta \hat{a}_n^\dagger\hat{a}_n + \cos 2\theta \hat{a}_n^\dagger\hat{a}_{\bar{n}} + \cos 2\theta \hat{a}_{\bar{n}}^\dagger\hat{a}_n -\sin 2\theta \hat{a}_{\bar{n}}^\dagger\hat{a}_{\bar{n}} \right]\\
\hat{S}_3 &= \frac{1}{2i}\left\{\left(\!\begin{array}{cc}\hat{a}_n^\dagger,& \hat{a}_{\bar{n}}^\dagger\end{array} \!\right)
\bullet\left[\mathbf{R}^{-1}_{[1,:]}{}^\dagger(\theta)\bullet\mathbf{R}^{-1}_{[2,:]}(\theta) - \mathbf{R}^{-1}_{[2,:]}{}^\dagger(\theta)\bullet\mathbf{R}^{-1}_{[1,:]}(\theta) \right]
\bullet\left(\!\begin{array}{c}\hat{a}_n\\ \hat{a}_{\bar{n}}\end{array} \!\right) \right\}\nn\\
&= \frac{1}{2i} \left[\hat{a}_n^\dagger\hat{a}_{\bar{n}} - \hat{a}_{\bar{n}}^\dagger\hat{a}_n  \right].
\end{align}
\end{subequations}
In deriving the equations above, we have denoted $ \mathbf{R}_{[i,:]}(\theta) $ as the $ i $-th row of $ \mathbf{R}(\theta) $ and $ \mathbf{R}_{[i,:]}^\dagger(\theta) $ as the conjugate transpose of the $ i $-th row of $ \mathbf{R}(\theta) $.
As a shorthand, these relationships of Stokes operators can be expressed as an operator transformation, $ \hat{\mathbf{S}}=\mathbf{M}\bullet\hat{\mathbf{A}}_{n,\bar{n}} $, where $ \hat{\mathbf{S}}=[\hat{S}_0;\hat{S}_1;\hat{S}_2;\hat{S}_3] $ and $ \hat{\mathbf{A}}_{n,\bar{n}}=[\hat{a}_n^\dagger\hat{a}_n;\hat{a}_n^\dagger\hat{a}_{\bar{n}};\hat{a}_{\bar{n}}^\dagger\hat{a}_n;\hat{a}_{\bar{n}}^\dagger\hat{a}_{\bar{n}}] $ are the operator vectors and $ \mathbf{M} $ is the transformation matrix defined by the transformation coefficients in Eqs.\eqref{eq:Snnbar}.
One can prove that the inversed transformation matrix $ \mathbf{M}^{-1}=2\mathbf{M}^\dagger $, and $ \mathbf{M} $ can be derived in the following form, in general,
\begin{align}
\mathbf{M} &=\frac{1}{2}\left(\!\begin{array}{c}
\mathrm{vec}_r\left[\mathbf{R}^{-1}_{[1,:]}{}^\dagger(\theta)\mathbf{R}^{-1}_{[1,:]}(\theta) + \mathbf{R}^{-1}_{[2,:]}{}^\dagger(\theta)\mathbf{R}^{-1}_{[2,:]}(\theta) \right]\\
\mathrm{vec}_r\left[\mathbf{R}^{-1}_{[1,:]}{}^\dagger(\theta)\mathbf{R}^{-1}_{[1,:]}(\theta) - \mathbf{R}^{-1}_{[2,:]}{}^\dagger(\theta)\mathbf{R}^{-1}_{[2,:]}(\theta) \right]\\
\mathrm{vec}_r\left[\mathbf{R}^{-1}_{[1,:]}{}^\dagger(\theta)\mathbf{R}^{-1}_{[2,:]}(\theta) + \mathbf{R}^{-1}_{[2,:]}{}^\dagger(\theta)\mathbf{R}^{-1}_{[1,:]}(\theta) \right]\\
-i\mathrm{vec}_r\left[\mathbf{R}^{-1}_{[1,:]}{}^\dagger(\theta)\mathbf{R}^{-1}_{[2,:]}(\theta) - \mathbf{R}^{-1}_{[2,:]}{}^\dagger(\theta)\mathbf{R}^{-1}_{[1,:]}(\theta) \right]
 \end{array} \!\right)\\
&= \frac{1}{2}\left(\!\begin{array}{cccc} 1,&0,&0,& 1\\
\cos 2\theta,&-\sin 2\theta, & -\sin 2\theta, & -\cos 2\theta\\
\sin 2\theta, & \cos 2\theta, & \cos 2\theta, & -\sin 2\theta\\
0,&-i,& i,& 0\end{array}\!\right),
\end{align}
where $ \mathrm{vec}_r[\cdot] $ means the vectorization of a matrix by concatenating its rows. 


By using the vector space representation, the E-field operator can be written in the $ \{n,\bar{n}\} $ basis by 
\begin{align}
\hat{\mathbf{E}}^{(+)}(\br;t) &= \sqrt{ \frac{2 \pi \hbar \omega_0}{ v_g} } \left[\mathbf{u}_H(r\!_\perp,\phi) \hat{a}_H(z,t) + \mathbf{u}_V(r\!_\perp,\phi) \hat{a}_V(z,t)\right]  e^{i (\beta_0 z- \omega_0 t)}\\
&= \sqrt{ \frac{2 \pi \hbar \omega_0}{ v_g} } \left(\!\begin{array}{cc}\mathbf{u}_H, & \mathbf{u}_V\end{array}\!\right)
\bullet \left(\!\begin{array}{c}\hat{a}_H\\ \hat{a}_V\end{array} \!\right)  e^{i (\beta_0 z- \omega_0 t)}\\
&= \sqrt{ \frac{2 \pi \hbar \omega_0}{ v_g} } \left(\!\begin{array}{cc}\mathbf{u}_H, & \mathbf{u}_V\end{array}\!\right)\bullet\mathbf{R}^T(\theta)
\bullet \mathbf{R}(\theta)\bullet\left(\!\begin{array}{c}\hat{a}_H\\ \hat{a}_V\end{array} \!\right)  e^{i (\beta_0 z- \omega_0 t)}\\
&= \sqrt{ \frac{2 \pi \hbar \omega_0}{ v_g} } \left(\!\begin{array}{cc}\mathbf{u}_n, & \mathbf{u}_{\bar{n}}\end{array}\!\right)
\bullet \left(\!\begin{array}{c}\hat{a}_n\\ \hat{a}_{\bar{n}}\end{array} \!\right)  e^{i (\beta_0 z- \omega_0 t)}\\
&= \sqrt{ \frac{2 \pi \hbar \omega_0}{ v_g} } \left[\mathbf{u}_n(r\!_\perp,\phi) \hat{a}_n(z,t) + \mathbf{u}_{\bar{n}}(r\!_\perp,\phi) \hat{a}_{\bar{n}}(z,t)\right]  e^{i (\beta_0 z- \omega_0 t)}.\label{eq:Efieldop_nnbar}
\end{align}
As expected, the field operator preserves the form in the new basis as defined in Eq.\eqref{eq:Ebp}.

Therefore, the effective atom-light interaction Hamiltonian can be written as
\begin{align}
\hat{h}_\eff &= -\hat{\mathbf{E}}^{(-)}(\br')\cdot\hat{\tensor{\mathbf{\alpha}}}\cdot\hat{\mathbf{E}}^{(+)}(\br')\nn\\
&=-\frac{2 \pi \hbar \omega_0}{ v_g}
\left(\!\begin{array}{cc}\hat{a}_n^\dagger, & \hat{a}_{\bar{n}}^\dagger\end{array} \!\right)\bullet \left(\!\begin{array}{c}\mathbf{u}_n^*\\ \mathbf{u}_{\bar{n}}^*\end{array}\!\right)
\cdot\hat{\tensor{\mathbf{\alpha}}}\cdot
\left(\!\begin{array}{cc}\mathbf{u}_n, & \mathbf{u}_{\bar{n}}\end{array}\!\right)
\bullet \left(\!\begin{array}{c}\hat{a}_n\\ \hat{a}_{\bar{n}}\end{array} \!\right) \nn\\
&= \hbar \left(\!\begin{array}{cc}\hat{a}_n^\dagger, & \hat{a}_{\bar{n}}^\dagger\end{array} \!\right)\bullet
\left(\!\begin{array}{cc} \hat{\chi}_{nn},&\hat{\chi}_{n\bar{n}}\\
\hat{\chi}_{\bar{n}n},&\hat{\chi}_{\bar{n}\bar{n}}\end{array} \!\right)
\bullet\left(\!\begin{array}{c}\hat{a}_n\\ \hat{a}_{\bar{n}}\end{array} \!\right) \nn\\
&= \hbar \hat{\boldsymbol{\chi}}_{n,\bar{n}}^\dagger\bullet \hat{\mathbf{A}}_{n,\bar{n}}= \hbar \hat{\boldsymbol{\chi}}_{n,\bar{n}}^\dagger\bullet 2\mathbf{M}^\dagger\bullet \hat{\mathbf{S}}\\
&= \hbar\left\{(\hat{\chi}_{nn}+ \hat{\chi}_{\bar{n}\bar{n}})\hat{S}_0 \right.\nn\\
&\quad+ [\cos 2\theta \hat{\chi}_{nn}- \sin 2\theta(\hat{\chi}_{n\bar{n}}+\hat{\chi}_{\bar{n}n}) - \cos 2\theta\hat{\chi}_{\bar{n}\bar{n}}]\hat{S}_1 \nn\\
&\quad+ [\sin 2\theta \hat{\chi}_{nn}+ \cos 2\theta(\hat{\chi}_{n\bar{n}}+\hat{\chi}_{\bar{n}n}) - \sin 2\theta \hat{\chi}_{\bar{n}\bar{n}}]\hat{S}_2 \nn\\
&\quad+\left. i \left(\hat{\chi}_{n\bar{n}}-\hat{\chi}_{\bar{n}n}\right)\hat{S}_3 \right\}.\label{eq:heff_nnbarChiS}
\end{align}
In deriving the expression above, we have defined $\hat{\boldsymbol{\chi}}_{n,\bar{n}}=[\hat{\chi}_{nn};\hat{\chi}_{n\bar{n}};\hat{\chi}_{\bar{n}n};\hat{\chi}_{\bar{n}\bar{n}}]$ as the coupling operator vector.
The coupling coefficient elements of $ 2\mathbf{M}^\dagger $, $ 2M_{ij} $, correspond to the coupling coefficients in Eq.\eqref{eq:heff_nnbarChiS} between the spin operators in $ \hat{\boldsymbol{\chi}}_{n,\bar{n}} $ and the polarization operators in $ \hat{\mathbf{S}} $, and each column of $ 2\mathbf{M}^\dagger $ corresponds to the coefficients in the corresponding line of the $ \hat{S}_i $ coupling term in Eq.\eqref{eq:heff_nnbarChiS}.


If we set $ \theta=\pi/4 $, we will be in the $ \{\mathbf{e}_D,\mathbf{e}_{\bar{D}} \} $ basis.
\begin{subequations}
\begin{align}
\hat{a}_D^\dagger &= \frac{1}{\sqrt{2}}(\hat{a}_H^\dagger+\hat{a}_V^\dagger)\\
\hat{a}_{\bar{D}}^\dagger &= \frac{1}{\sqrt{2}}(\hat{a}_V^\dagger-\hat{a}_H^\dagger),
\end{align}
\end{subequations}
or,
\begin{subequations}
\begin{align}
\hat{a}_H &= \frac{1}{\sqrt{2}}(\hat{a}_D-\hat{a}_{\bar{D}})\\
\hat{a}_V &= \frac{1}{\sqrt{2}}(\hat{a}_D+\hat{a}_{\bar{D}}).
\end{align}
\end{subequations}
The Stokes operators becomes
\begin{subequations}
\begin{align}
\hat{S}_0 &= \frac{1}{2} \left[\hat{a}_D^\dagger\hat{a}_D+\hat{a}_{\bar{D}}^\dagger\hat{a}_{\bar{D}} \right]\\
\hat{S}_1 &= -\frac{1}{2} \left[ \hat{a}_D^\dagger\hat{a}_{\bar{D}} +  \hat{a}_{\bar{D}}^\dagger\hat{a}_D \right]\\
\hat{S}_2 &= \frac{1}{2} \left[ 
\hat{a}_D^\dagger\hat{a}_D -\hat{a}_{\bar{D}}^\dagger\hat{a}_{\bar{D}} \right]\\
\hat{S}_3 &= \frac{1}{2i} \left[\hat{a}_D^\dagger\hat{a}_{\bar{D}}-\hat{a}_{\bar{D}}^\dagger\hat{a}_D \right].
\end{align}
\end{subequations}
The field operator becomes 
\begin{align}
\hat{\mathbf{E}}^{(+)}(\br;t) &=\sqrt{ \frac{2 \pi \hbar \omega_0}{ v_g} } \left[\mathbf{u}_D(r\!_\perp,\phi) \hat{a}_D(z,t)+\mathbf{u}_{\bar{D}}(r\!_\perp,\phi) \hat{a}_{\bar{D}}(z,t)  \right]e^{i (\beta_0 z- \omega_0 t)}.
\end{align}
The effective Hamiltonian can be simplified from Eq.\eqref{eq:heff_nnbarChiS} to 
\begin{align}
\hat{h}_\eff &= \hbar[(\hat{\chi}_{DD}+\hat{\chi}_{\bar{D}\bar{D}})\hat{S}_0 -(\hat{\chi}_{D\bar{D}}+\hat{\chi}_{\bar{D}D} )\hat{S}_1\nn\\
&\quad + (\hat{\chi}_{DD}-\hat{\chi}_{\bar{D}\bar{D}})\hat{S}_2 +i(\hat{\chi}_{D\bar{D}}-\hat{\chi}_{\bar{D}D} )\hat{S}_3].
\end{align}
The Hamiltonian expression above should satisfy the cyclical transformation from the $ H $- and $ V $-basis expression.


\section{Spin-polarization Hamiltonian and Stokes vector operators in the circular basis}
We define a set of polarization vector transformation relationships by 
\begin{subequations}
\begin{align}
\hat{a}_H^\dagger &= \frac{1}{\sqrt{2}}(\hat{a}_R^\dagger+\hat{a}_L^\dagger )\\
\hat{a}_V^\dagger &= \frac{1}{i\sqrt{2}}(\hat{a}_R^\dagger-\hat{a}_L^\dagger ),
\end{align}
\end{subequations}
or the inverse
\begin{subequations}
\begin{align}
\hat{a}_R^\dagger &= \frac{1}{\sqrt{2}}(\hat{a}_H^\dagger+i\hat{a}_V^\dagger )\\
\hat{a}_L^\dagger &= \frac{1}{\sqrt{2}}(\hat{a}_H^\dagger-i\hat{a}_V^\dagger ),
\end{align}
\end{subequations}
where $ R $($ L $) indicates the right(left)-circularly polarized mode.
The Stokes operators can then be defined in both linear ($ H $ and $ V $) and circular ($ L $ and $ R $) polarization bases by
\begin{subequations}\label{eq:SaHVaRL}
\begin{align}
\hat{S}_0 &= \frac{1}{2} \left[\hat{a}_H^\dagger\hat{a}_H+\hat{a}_V^\dagger\hat{a}_V \right] = \frac{1}{2} \left[\hat{a}_R^\dagger\hat{a}_R+\hat{a}_L^\dagger\hat{a}_L \right]\\
\hat{S}_1 &= \frac{1}{2} \left[\hat{a}_H^\dagger\hat{a}_H-\hat{a}_V^\dagger\hat{a}_V \right] = \frac{1}{2} \left[\hat{a}_R^\dagger\hat{a}_L+\hat{a}_L^\dagger\hat{a}_R \right]\\
\hat{S}_2 &= \frac{1}{2} \left[\hat{a}_H^\dagger\hat{a}_V+\hat{a}_V^\dagger\hat{a}_H \right] = \frac{i}{2} \left[\hat{a}_L^\dagger\hat{a}_R-\hat{a}_R^\dagger\hat{a}_L \right]\\
\hat{S}_3 &= \frac{1}{2i} \left[\hat{a}_H^\dagger\hat{a}_V-\hat{a}_V^\dagger\hat{a}_H \right] = \frac{1}{2} \left[\hat{a}_R^\dagger\hat{a}_R-\hat{a}_L^\dagger\hat{a}_L \right].
\end{align}
\end{subequations}
The inversed transformations can be easily derived by inverting the transformation coefficient matrices. 

Based on Eq.\eqref{eq:Ebp}, when the input probe can be decomposed into degenerate orthonormal guided modes in the $H/V $ or $ R/L $ bases, the E-field operator can be written in the quasilinear and quasicircular mode bases by 
\begin{align}
\hat{\mathbf{E}}^{(+)}(r\!_\perp,\phi,z;t) &= \sqrt{ \frac{2 \pi \hbar \omega_0}{ v_g} } \left[\mathbf{u}_H(r\!_\perp,\phi) \hat{a}_H(z,t) + \mathbf{u}_V(r\!_\perp,\phi) \hat{a}_V(z,t)\right]  e^{i (\beta_0 z- \omega_0 t)}\\
&= \sqrt{ \frac{2 \pi \hbar \omega_0}{ v_g} } \left[\mathbf{u}_R(r\!_\perp,\phi) \hat{a}_R(z,t) + \mathbf{u}_L(r\!_\perp,\phi) \hat{a}_L(z,t)\right]  e^{i (\beta_0 z- \omega_0 t)}.
\end{align}
Therefore, the effective atom-light interaction Hamiltonian can be given in those bases by 
\begin{align}
\hat{h}_\eff &= -\hat{\mathbf{E}}^{(-)}(\br')\cdot\hat{\tensor{\mathbf{\alpha}}}\cdot\hat{\mathbf{E}}^{(+)}(\br')\nn\\
&= \hbar\left[(\hat{\chi}_{HH}\!+\!\hat{\chi}_{VV})\hat{S}_0 \!+\! (\hat{\chi}_{HH}\!-\!\hat{\chi}_{VV})\hat{S}_1 \!+\! (\hat{\chi}_{HV}\!+\!\hat{\chi}_{VH})\hat{S}_2 \!+\! i(\hat{\chi}_{HV}\!-\!\hat{\chi}_{VH})\hat{S}_3 \right]\\
&= \hbar\!\left[\!(\hat{\chi}_{RR}\!+\!\hat{\chi}_{LL})\hat{S}_0 \!+\! (\hat{\chi}_{RL}\!+\!\hat{\chi}_{LR})\hat{S}_1 \!\!+\! i(\hat{\chi}_{RL}\!\!-\!\!\hat{\chi}_{LR})\hat{S}_2 \!+\! (\hat{\chi}_{RR}\!-\!\!\hat{\chi}_{LL})\hat{S}_3 \!\right]\\
&=\hbar\sum_{i=0}^3 \hat{\chi}_{i}\hat{S}_i\\
&=\hbar\sum_{i,j=0} \chi_{ij}\hat{f}_i\hat{S}_j,
\end{align}
with $\hat{\chi}_{pp'} $ defined in Eq.\eqref{eq:chippp}.
\qxd{Double check the cited equation after the main text is done. Maybe I can define $ \hat{\chi}_{pp'}$ in this appendix.}

\section{Extension to arbitrary elliptical polarization basis}
Using the isomorphic properties of \Poincare sphere and Block sphere, one can show that the linear polarization basis rotation transformation defined in the $ \{\ket{H},\ket{V} \} $ basis (see Eq.~\eqref{eq:nnbarRHV}) can be mapped to a the Pauli rotation around the $ z $ axis in the $ x $ basis on the Bloch sphere. To further extend the rotation transformation from the $ \{\ket{H},\ket{V} \} $ basis to arbitrary orthogonal elliptical polarization basis, one may need to make the following steps in order to use the known transformation relationships in the Block sphere:

1. Define the transformation Pauli matrices in the $ x $ basis, that is to define 
\begin{align}
\hat{\sigma}_x = \left(\!\!\begin{array}{cc}
1 & 0 \\
0 & -1
\end{array}\!\!\right), \quad
\hat{\sigma}_y = \left(\!\!\begin{array}{cc}
0 & 1 \\
1 & 0
\end{array}\!\!\right), \quad
\hat{\sigma}_z = \left(\!\!\begin{array}{cc}
0 & -i \\
i & 0
\end{array}\!\!\right).
\end{align}

2. Map the south pole of the Bloch sphere to the $ \ket{R} $ state and the north pole to the $ \ket{L'} $ state, where the left circular polarization state $ \ket{L}=-i\ket{L'} $. As a result, the elliptical polarization state in optics will have a phase difference as we map them to the new Bloch sphere.

On the new ``Bloch sphere", an arbitrary orthogonal polarization basis $ \{ \ket{p},\ket{\bar{p}} \} $ can be transformed from the $ \{\ket{H},\ket{V} \} $ basis by an rotation $ \Theta $ around the unit $ \mathbf{n} $ vector with a coordinate corresponding to a point on the ``Bloch sphere". That is 
\begin{align}
\left(\!\!\begin{array}{c}
\ket{p} \\
\ket{\bar{p}} 
\end{array}\!\!\right) = \left[\cos(\Theta/2) \identity + i\sin(\Theta/2)(\mathbf{n}^T\bullet \left(\!\!\begin{array}{c}
\hat{\sigma}_x \\
\hat{\sigma}_y\\
\hat{\sigma}_z
\end{array}\!\!\right) )\right] \left(\!\!\begin{array}{c}
\ket{H} \\
\ket{V}
\end{array}\!\!\right),
\end{align}
where $ \mathbf{n}^T=[x,y,z] $ is the Cartesian coordinate of the rotation axis. Transformation matrix in the square brackets is the new transition matrix $ \mathbf{R} $ as we have used in this appendix earlier. When $ \{\ket{p},\ket{\bar{p}} \} $ are linear states, $ \Theta/2 =\theta $ as we have defined in Eq.~\eqref{eq:nnbarRHV}.

Similarly, one can define the polarization state transformation relationship in the $ \{\ket{R},\ket{L'} \} $ basis using Pauli matrices in the $ z $ basis. 

With the transformation relation defined, we can define the Stokes operators, field operator and atom-light interaction Hamiltonian in an arbitrary elliptical polarization basis as we did in Sec.~\ref{sec:spinpolarizationinlinearbasis} for linear polarization transformations. This technique may be useful, for example, to find the optimal choice of polarization basis to generate the best spin squeezing result. As this dissertation work doesn't focus on a full optimization problem, we will skip the results for now.

%</basistransfHS>

%###################################################################################
\bibliographystyle{../styles/abbrv-alpha-letters-links}
\bibliography{../refs/Archive}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\printindex
\end{document}